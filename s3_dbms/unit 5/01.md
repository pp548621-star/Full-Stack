# Transaction Concepts

## 1. What is a Transaction?

* A **transaction** is a **logical unit of work** that performs one or more database operations (like `INSERT`, `UPDATE`, `DELETE`).
* It must be executed **completely** or **not at all**.
* Transactions ensure the **integrity and correctness** of a database.

ðŸ‘‰ In the **CodingGita Student Portal**, examples of transactions:

1. **Student Fee Payment**

   * Deduct fee amount from student account.
   * Update payment status in DB.
   * Generate receipt entry.
   * If any step fails â†’ entire transaction must rollback.

2. **Faculty Updating Marks**

   * Insert/Update marks in Enrollment table.
   * Recalculate student GPA.
   * Update Transcript table.
   * If GPA update fails â†’ marks update must also rollback.

---

## 2. Properties of Transactions (ACID)

The reliability of transactions depends on the **ACID properties**:

---

### 2.1 Atomicity â€“ All or Nothing

* A transaction is **atomic** â†’ either all steps execute or none.
* If one step fails, the transaction rolls back.

ðŸ‘‰ Example: Student pays fees.

* Debit `â‚¹50,000` from Bank Account.
* Insert record in Fee table.
* If receipt insertion fails â†’ rollback debit.

```sql
BEGIN;
   UPDATE Bank SET Balance = Balance - 50000 WHERE AccNo = 123;
   INSERT INTO FeePayment VALUES (101, '2025-08-26', 50000);
ROLLBACK; -- if any error occurs
```

---

### 2.2 Consistency â€“ Valid State â†’ Valid State

* A transaction must transform the database from one **consistent state** to another.
* Constraints (PRIMARY KEY, FOREIGN KEY, CHECK) are always preserved.

ðŸ‘‰ Example:

* If a faculty inserts marks for RollNo `999` (nonexistent student) â†’ constraint violation â†’ transaction rejected.

```sql
INSERT INTO Enrollment (RollNo, CourseID, Marks)
VALUES (999, 'CS101', 90);
-- Error: FOREIGN KEY constraint fails
```

---

### 2.3 Isolation â€“ Transactions Donâ€™t Interfere

* When multiple users run transactions at the same time, each behaves as if it were the **only transaction**.
* Prevents anomalies like **dirty reads, lost updates**.

ðŸ‘‰ Example:

* Faculty A updates marks of RollNo 101 â†’ from 80 to 90.
* At the same time, Faculty B tries to read marks.
* Isolation ensures Faculty B sees **old value (80)** until Faculty A commits.

```sql
-- Session A
BEGIN;
UPDATE Enrollment SET Marks = 90 WHERE RollNo = 101;

-- Session B (before commit in A)
SELECT Marks FROM Enrollment WHERE RollNo = 101;
-- Output: 80 (not 90 yet)
```

---

### 2.4 Durability â€“ Permanent Once Committed

* Once a transaction is committed, its changes are **permanent**, even if the system crashes.

ðŸ‘‰ Example:

* Faculty updates marks and commits.
* System crashes immediately after.
* When DB restarts â†’ committed marks remain intact.

```sql
COMMIT; -- ensures durability
```

---

## 3. Transaction States

A transaction passes through **different states**:

1. **Active** â†’ executing statements.
2. **Partially Committed** â†’ final statement executed, waiting for COMMIT.
3. **Committed** â†’ all changes saved permanently.
4. **Failed** â†’ error occurred, transaction cannot proceed.
5. **Aborted** â†’ all changes undone via ROLLBACK.

---

## 4. Transaction Control in SQL

SQL provides commands for managing transactions:

### 4.1 COMMIT

* Saves all changes permanently.

```sql
UPDATE Enrollment SET Marks = 95 WHERE RollNo = 101;
COMMIT;
```

---

### 4.2 ROLLBACK

* Undoes changes since last COMMIT.

```sql
DELETE FROM Student WHERE RollNo = 103;
ROLLBACK; -- student restored
```

---

### 4.3 SAVEPOINT

* Creates a checkpoint inside a transaction.
* Allows partial rollbacks.

```sql
BEGIN;
UPDATE Student SET City = 'Rajkot' WHERE RollNo = 101;
SAVEPOINT sp1;

UPDATE Student SET City = 'Surat' WHERE RollNo = 102;
ROLLBACK TO sp1; -- only undo changes after sp1
COMMIT;
```

---

## 5. CodingGita Example â€“ Fee Payment Transaction

```sql
BEGIN;

UPDATE Bank SET Balance = Balance - 50000 WHERE AccNo = 123;
INSERT INTO FeePayment VALUES (101, '2025-08-26', 50000);

-- Simulate error
-- INSERT INTO Receipt VALUES (NULL, 101, '2025-08-26');

ROLLBACK; -- ensures no partial fee deduction

COMMIT; -- only when all steps succeed
```

ðŸ‘‰ If receipt insertion fails â†’ no deduction occurs.
ðŸ‘‰ If all succeed â†’ fee payment committed permanently.

---

## 6. Summary

* A **transaction** is a logical unit of work in DB.
* Ensures **reliability & correctness** using **ACID properties**.

  * Atomicity â†’ all or nothing.
  * Consistency â†’ DB valid state maintained.
  * Isolation â†’ concurrent transactions independent.
  * Durability â†’ committed changes survive failures.
* SQL provides **COMMIT, ROLLBACK, SAVEPOINT** for transaction control.
* In **CodingGita DB**, transactions ensure correctness in **fee payment, marks update, course enrollment**.

---
