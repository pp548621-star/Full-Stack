# Lock-based Protocols

## 1. Introduction

* A **lock** is a mechanism that controls access to a database item (row, table, attribute).
* Locks prevent **two transactions from performing conflicting operations at the same time**.
* Lock-based protocols ensure that schedules are **serializable** and **free from concurrency problems**.

ðŸ‘‰ Example in **CodingGita DB**:

* If Faculty A is updating Jenilâ€™s marks, Faculty B must **wait** until Faculty A finishes (to avoid lost update).

---

## 2. Types of Locks

### 2.1 Shared Lock (S-Lock / Read Lock)

* A transaction can **read** the item but not write.
* Multiple transactions can hold shared locks on the same item.

ðŸ‘‰ Example:

* Faculty A and Faculty B both viewing student marks â†’ allowed.

---

### 2.2 Exclusive Lock (X-Lock / Write Lock)

* A transaction can **read and write** the item.
* No other transaction can access it (read or write) until lock is released.

ðŸ‘‰ Example:

* Faculty A updating student marks â†’ Faculty B cannot read/write until update finishes.

---

## 3. Lock Compatibility

| Lock Type         | Shared (S)      | Exclusive (X)   |
| ----------------- | --------------- | --------------- |
| **Shared (S)**    | âœ” (Allowed)     | âœ˜ (Not Allowed) |
| **Exclusive (X)** | âœ˜ (Not Allowed) | âœ˜ (Not Allowed) |

ðŸ‘‰ Two transactions can share a read, but only one can write.

---

## 4. Lock-based Protocols

### 4.1 Simple Locking Protocol

* A transaction must acquire lock before accessing a data item.
* Release lock after access.
* Problem â†’ **may lead to deadlocks**.

---

### 4.2 Two-Phase Locking (2PL) Protocol

Ensures **serializability** by dividing execution into two phases:

1. **Growing Phase**

   * Transaction acquires all required locks.
   * Cannot release any lock.

2. **Shrinking Phase**

   * Transaction releases locks.
   * Cannot acquire new locks.

ðŸ‘‰ Guarantees **conflict-serializability**, but may cause deadlocks.

---

### Example â€“ 2PL with CodingGita DB

* **T1**: Faculty updates Marks.
* **T2**: Admin updates City.

**Schedule under 2PL:**

```
T1: Lock-X(Marks)   â†’ Acquire lock
T1: Write(Marks=92)
T2: Lock-X(City)    â†’ Acquire lock
T2: Write(City='Surat')
T1: Unlock(Marks)
T2: Unlock(City)
```

ðŸ‘‰ Transactions follow growing phase (lock first), shrinking phase (unlock later).

---

## 5. Problems with Locks

### 5.1 Deadlock

* Two transactions wait for each other indefinitely.

ðŸ‘‰ Example:

* **T1** locks Marks, needs City.
* **T2** locks City, needs Marks.
* Both wait forever.

**Wait-for Graph (Deadlock):**

```
T1 â†’ T2
T2 â†’ T1
(Cycle â†’ Deadlock)
```

---

### 5.2 Starvation

* A transaction waits indefinitely because locks are repeatedly given to other transactions.

ðŸ‘‰ Example:

* Faculty A keeps updating marks frequently.
* Faculty Bâ€™s read request never gets chance.

---

## 6. Lock Granularity

* Locks can be applied at different levels:

  * **Row-level lock** â†’ fine-grained (higher concurrency).
  * **Table-level lock** â†’ coarse-grained (less concurrency, more safety).

ðŸ‘‰ Example:

* Row lock: Only RollNo 101 locked â†’ others still accessible.
* Table lock: Entire Student table locked â†’ no one else can access.

---

## 7. Example â€“ Lock Conflict in CodingGita DB

### Without Locks

* **T1**: Update RollNo 101 Marks to 90.
* **T2**: Read RollNo 101 Marks.
* T2 may read uncommitted value â†’ dirty read.

### With Locks

* **T1**: Acquires Exclusive Lock on Marks.
* **T2**: Waits until T1 commits and unlocks.
* T2 reads correct committed value.

---

## 8. Summary

* Locks control **concurrent access** to avoid conflicts.
* **Shared Lock (S)** â†’ allows multiple reads.
* **Exclusive Lock (X)** â†’ only one read/write allowed.
* **Lock Compatibility Matrix** â†’ Sâ€“S allowed, Sâ€“X not, Xâ€“X not.
* **Two-Phase Locking (2PL)** ensures serializability but may cause deadlocks.
* **Problems**: Deadlock, Starvation.
* **Lock Granularity** â†’ row-level vs table-level.
* In **CodingGita DB**, locks ensure correctness in **marks updates, fee transactions, and enrollments**.

---
