# Exception Handling in PL/SQL

## 1. Introduction

* Errors may occur while executing PL/SQL (e.g., invalid roll number, division by zero, constraint violation).
* Instead of crashing, PL/SQL provides **Exception Handling** to **catch errors and handle them gracefully**.

ðŸ‘‰ In **CodingGita portal**:

* If a faculty tries to fetch marks of a student that does not exist â†’ PL/SQL should print a friendly message instead of error.
* If a calculation divides by zero â†’ program should handle it properly.

---

## 2. Structure of Exception Handling

A PL/SQL block can have an **EXCEPTION section**:

```sql
DECLARE
   -- variable declarations
BEGIN
   -- main program logic
EXCEPTION
   WHEN exception_name THEN
      -- error handling code
   WHEN OTHERS THEN
      -- generic error handling
END;
/
```

---

## 3. Types of Exceptions

### 3.1 Predefined Exceptions (Built-in)

Oracle provides many ready exceptions:

| Exception        | When it Occurs                          |
| ---------------- | --------------------------------------- |
| `NO_DATA_FOUND`  | `SELECT INTO` returns no row            |
| `TOO_MANY_ROWS`  | `SELECT INTO` returns more than one row |
| `ZERO_DIVIDE`    | Division by zero                        |
| `INVALID_NUMBER` | Invalid conversion (string â†’ number)    |

---

### Example 1 â€“ NO\_DATA\_FOUND

```sql
DECLARE
   v_name Student.Name%TYPE;
BEGIN
   SELECT Name INTO v_name
   FROM Student
   WHERE RollNo = 999;  -- Student doesnâ€™t exist

   DBMS_OUTPUT.PUT_LINE('Student: ' || v_name);

EXCEPTION
   WHEN NO_DATA_FOUND THEN
      DBMS_OUTPUT.PUT_LINE('No student found with that RollNo.');
END;
/
```

**Output**

```
No student found with that RollNo.
```

---

### Example 2 â€“ TOO\_MANY\_ROWS

```sql
DECLARE
   v_city Student.City%TYPE;
BEGIN
   -- If multiple students are from Ahmedabad, this fails
   SELECT City INTO v_city
   FROM Student
   WHERE City = 'Ahmedabad';

   DBMS_OUTPUT.PUT_LINE('City: ' || v_city);

EXCEPTION
   WHEN TOO_MANY_ROWS THEN
      DBMS_OUTPUT.PUT_LINE('Multiple students found in that city!');
END;
/
```

---

### Example 3 â€“ ZERO\_DIVIDE

```sql
DECLARE
   marks NUMBER := 85;
   students NUMBER := 0;
   avg_marks NUMBER;
BEGIN
   avg_marks := marks / students;

   DBMS_OUTPUT.PUT_LINE('Average Marks: ' || avg_marks);

EXCEPTION
   WHEN ZERO_DIVIDE THEN
      DBMS_OUTPUT.PUT_LINE('Error: Cannot divide by zero!');
END;
/
```

**Output**

```
Error: Cannot divide by zero!
```

---

## 4. User-Defined Exceptions

* Programmers can define their own exceptions using `RAISE`.

### Example 4 â€“ Invalid Semester Exception

```sql
DECLARE
   v_semester NUMBER := 10;
   ex_invalid_sem EXCEPTION;
BEGIN
   IF v_semester < 1 OR v_semester > 8 THEN
      RAISE ex_invalid_sem;
   END IF;

   DBMS_OUTPUT.PUT_LINE('Valid Semester: ' || v_semester);

EXCEPTION
   WHEN ex_invalid_sem THEN
      DBMS_OUTPUT.PUT_LINE('Error: Semester must be between 1 and 8.');
END;
/
```

**Output**

```
Error: Semester must be between 1 and 8.
```

---

## 5. WHEN OTHERS (Generic Handler)

* Catches **all unhandled exceptions**.
* Should be used carefully (ideally log errors).

### Example 5 â€“ Generic Exception Handling

```sql
DECLARE
   v_marks NUMBER := 'ABC';  -- Invalid assignment
BEGIN
   DBMS_OUTPUT.PUT_LINE('Marks: ' || v_marks);

EXCEPTION
   WHEN OTHERS THEN
      DBMS_OUTPUT.PUT_LINE('An unexpected error occurred.');
END;
/
```

---

## 6. RAISE\_APPLICATION\_ERROR

* Used to **raise custom errors** with error code & message.
* Syntax:

```sql
RAISE_APPLICATION_ERROR(-20001, 'Custom error message');
```

### Example 6 â€“ Custom Error for Low Marks

```sql
DECLARE
   v_marks NUMBER := 25;
BEGIN
   IF v_marks < 40 THEN
      RAISE_APPLICATION_ERROR(-20001, 'Student has failed with low marks.');
   END IF;

EXCEPTION
   WHEN OTHERS THEN
      DBMS_OUTPUT.PUT_LINE(SQLERRM);  -- Prints custom error
END;
/
```

**Output**

```
ORA-20001: Student has failed with low marks.
```

---

## 7. Summary

* **Exception Handling** makes PL/SQL safe & robust.
* **Predefined Exceptions**: NO\_DATA\_FOUND, TOO\_MANY\_ROWS, ZERO\_DIVIDE, etc.
* **User-defined Exceptions**: Created with `EXCEPTION` & `RAISE`.
* **WHEN OTHERS**: Catch-all for unexpected errors.
* **RAISE\_APPLICATION\_ERROR**: Raise custom error messages.
* In **CodingGita DB**, exception handling ensures that invalid student records, division by zero, or missing data are managed gracefully.

---
