# PL/SQL Cursors

## 1. What is a Cursor?

* A **cursor** is a pointer to the **result set of a query**.
* When PL/SQL executes a `SELECT` statement, it creates an **area in memory** called the **context area**.
* A cursor is used to **access and manipulate rows in this context area**.

ðŸ‘‰ Think of a cursor as a **bookmark or iterator** that allows PL/SQL to go row-by-row through query results.

---

## 2. Types of Cursors

1. **Implicit Cursor** (Automatically created by PL/SQL for single-row queries).
2. **Explicit Cursor** (Programmer-defined for multi-row queries).

---

## 3. Implicit Cursors

* Created automatically when a single-row `SELECT INTO` is executed.
* Cursor attributes can be used:

  * `%FOUND` â†’ TRUE if at least one row was returned.
  * `%NOTFOUND` â†’ TRUE if no row returned.
  * `%ROWCOUNT` â†’ Number of rows affected.
  * `%ISOPEN` â†’ Always FALSE (implicit cursors close automatically).

---

### Example 1 â€“ Implicit Cursor with SELECT INTO

```sql
DECLARE
   v_name Student.Name%TYPE;
BEGIN
   SELECT Name INTO v_name
   FROM Student
   WHERE RollNo = 101;

   IF SQL%FOUND THEN
      DBMS_OUTPUT.PUT_LINE('Student Found: ' || v_name);
   END IF;
END;
/
```

---

### Example 2 â€“ Implicit Cursor with UPDATE

```sql
BEGIN
   UPDATE Student
   SET City = 'Ahmedabad'
   WHERE RollNo = 102;

   DBMS_OUTPUT.PUT_LINE(SQL%ROWCOUNT || ' row(s) updated');
END;
/
```

**Output**

```
1 row(s) updated
```

---

## 4. Explicit Cursors

* Used when query returns **multiple rows**.
* Must be **declared, opened, fetched, and closed**.

### Steps in Explicit Cursor:

1. **DECLARE** the cursor.
2. **OPEN** the cursor (executes query).
3. **FETCH** rows one by one.
4. **CLOSE** the cursor.

---

### Example 3 â€“ Explicit Cursor for Student List

```sql
DECLARE
   CURSOR student_cur IS
      SELECT RollNo, Name, City FROM Student;
   v_roll Student.RollNo%TYPE;
   v_name Student.Name%TYPE;
   v_city Student.City%TYPE;
BEGIN
   OPEN student_cur;
   LOOP
      FETCH student_cur INTO v_roll, v_name, v_city;
      EXIT WHEN student_cur%NOTFOUND;
      DBMS_OUTPUT.PUT_LINE('RollNo: ' || v_roll || 
                           ', Name: ' || v_name || 
                           ', City: ' || v_city);
   END LOOP;
   CLOSE student_cur;
END;
/
```

ðŸ‘‰ This fetches and prints **all student records one by one**.

---

### Example 4 â€“ Explicit Cursor with Condition (Students from Semester 3)

```sql
DECLARE
   CURSOR sem3_cur IS
      SELECT RollNo, Name FROM Student WHERE Semester = 3;
   v_roll Student.RollNo%TYPE;
   v_name Student.Name%TYPE;
BEGIN
   OPEN sem3_cur;
   LOOP
      FETCH sem3_cur INTO v_roll, v_name;
      EXIT WHEN sem3_cur%NOTFOUND;
      DBMS_OUTPUT.PUT_LINE('Sem 3 Student: ' || v_name || ' (RollNo: ' || v_roll || ')');
   END LOOP;
   CLOSE sem3_cur;
END;
/
```

---

## 5. Cursor FOR Loops

Instead of manually opening/fetching/closing, we can use a **FOR loop**.
PL/SQL automatically handles open, fetch, and close.

### Example 5 â€“ Cursor FOR Loop for Enrollment

```sql
BEGIN
   FOR rec IN (SELECT S.Name, C.Title, E.Marks
               FROM Enrollment E
               JOIN Student S ON E.RollNo = S.RollNo
               JOIN Course C ON E.CourseID = C.CourseID) LOOP
      DBMS_OUTPUT.PUT_LINE(rec.Name || ' scored ' || rec.Marks || ' in ' || rec.Title);
   END LOOP;
END;
/
```

**Output**

```
Jenil scored 92 in DBMS
Mahir scored 76 in DSA
Arjun scored 95 in DBMS
Yashvi scored 85 in OS
```

ðŸ‘‰ Very compact, best for iteration over queries.

---

## 6. Cursor Attributes Recap

| Attribute   | Meaning                                    | Example                               |
| ----------- | ------------------------------------------ | ------------------------------------- |
| `%FOUND`    | TRUE if row fetched/affected               | IF SQL%FOUND THEN â€¦                   |
| `%NOTFOUND` | TRUE if no row fetched                     | EXIT WHEN cur%NOTFOUND                |
| `%ROWCOUNT` | Number of rows fetched/affected            | DBMS\_OUTPUT.PUT\_LINE(SQL%ROWCOUNT); |
| `%ISOPEN`   | TRUE if cursor is open (only for explicit) | IF cur%ISOPEN THEN â€¦                  |

---

## 7. Summary

* **Implicit Cursors** â†’ Auto-created, used for single-row SELECT/UPDATE/DELETE.
* **Explicit Cursors** â†’ Programmer-defined, used for multi-row queries.
* **Cursor FOR Loop** â†’ Simplifies iteration over result sets.
* Cursor attributes (`%FOUND`, `%NOTFOUND`, `%ROWCOUNT`, `%ISOPEN`) help in controlling logic.
* In CodingGita DB, cursors can:

  * Fetch all students in a semester.
  * Print marks course-wise.
  * Generate reports dynamically.

---
