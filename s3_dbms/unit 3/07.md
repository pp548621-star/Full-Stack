# Advanced Queries

## 1. Joins

Joins combine data from multiple tables based on related columns.

### 1.1 INNER JOIN

Returns only rows with **matching values in both tables**.

**Example â€“ Students with Course Titles**

```sql
SELECT S.Name, C.Title 
FROM Student S
INNER JOIN Enrollment E ON S.RollNo = E.RollNo
INNER JOIN Course C ON E.CourseID = C.CourseID;
```

**Output**

| Name   | Title |
| ------ | ----- |
| Jenil  | DBMS  |
| Mahir  | DSA   |
| Arjun  | DBMS  |
| Yashvi | OS    |

---

### 1.2 LEFT JOIN

Returns all rows from **left table**, and matching rows from right (NULL if no match).

**Example â€“ All Students with Courses (even if not enrolled)**

```sql
SELECT S.Name, C.Title 
FROM Student S
LEFT JOIN Enrollment E ON S.RollNo = E.RollNo
LEFT JOIN Course C ON E.CourseID = C.CourseID;
```

---

### 1.3 RIGHT JOIN

Opposite of LEFT JOIN â†’ All rows from right table, matching from left.

**Example â€“ All Courses with Students (even if no one enrolled)**

```sql
SELECT C.Title, S.Name
FROM Course C
RIGHT JOIN Enrollment E ON C.CourseID = E.CourseID
RIGHT JOIN Student S ON E.RollNo = S.RollNo;
```

---

### 1.4 FULL OUTER JOIN

Returns all rows from both tables; unmatched rows filled with NULL.
(Supported in PostgreSQL, Oracle, SQL Server).

**Example â€“ Students and Courses (including unmatched)**

```sql
SELECT S.Name, C.Title
FROM Student S
FULL OUTER JOIN Enrollment E ON S.RollNo = E.RollNo
FULL OUTER JOIN Course C ON E.CourseID = C.CourseID;
```

---

### 1.5 CROSS JOIN

Cartesian product = every row of one table with every row of another.

```sql
SELECT S.Name, C.Title
FROM Student S
CROSS JOIN Course C;
```

ðŸ‘‰ Produces (No. of Students Ã— No. of Courses) rows.

---

### 1.6 SELF JOIN

Table joined with itself (useful for hierarchical data).

**Example â€“ Students from Same City**

```sql
SELECT S1.Name AS Student1, S2.Name AS Student2, S1.City
FROM Student S1
INNER JOIN Student S2 ON S1.City = S2.City AND S1.RollNo < S2.RollNo;
```

**Output**

| Student1 | Student2 | City      |
| -------- | -------- | --------- |
| Jenil    | Krishna  | Ahmedabad |

---

## 2. Set Operations

Set operators combine results of **two or more queries**.

### 2.1 UNION

Returns unique rows from both queries.

```sql
SELECT City FROM Student
UNION
SELECT Dept FROM Faculty;
```

---

### 2.2 UNION ALL

Same as UNION, but keeps duplicates.

```sql
SELECT City FROM Student
UNION ALL
SELECT Dept FROM Faculty;
```

---

### 2.3 INTERSECT

Returns common rows between queries (not in MySQL, but in PostgreSQL/Oracle).

```sql
SELECT City FROM Student
INTERSECT
SELECT Dept FROM Faculty;
```

---

### 2.4 EXCEPT / MINUS

Returns rows from first query not in second.

```sql
SELECT City FROM Student
EXCEPT
SELECT Dept FROM Faculty;
```

---

## 3. Subqueries

A **subquery** is a query inside another query.

---

### 3.1 Simple Subquery

**Example â€“ Students with Marks > Average Marks**

```sql
SELECT Name 
FROM Student S
WHERE S.RollNo IN (
    SELECT RollNo 
    FROM Enrollment
    WHERE Marks > (SELECT AVG(Marks) FROM Enrollment)
);
```

---

### 3.2 Correlated Subquery

Subquery executed **for each row** in outer query.

**Example â€“ Students Scoring Above Course Average**

```sql
SELECT S.Name, E.CourseID, E.Marks
FROM Student S
JOIN Enrollment E ON S.RollNo = E.RollNo
WHERE E.Marks > (
    SELECT AVG(Marks) 
    FROM Enrollment 
    WHERE CourseID = E.CourseID
);
```

---

### 3.3 Subquery in FROM (Inline View)

```sql
SELECT CourseID, AvgMarks
FROM (
    SELECT CourseID, AVG(Marks) AS AvgMarks
    FROM Enrollment
    GROUP BY CourseID
) AS CourseStats
WHERE AvgMarks > 80;
```

---

### 3.4 EXISTS / NOT EXISTS

**Example â€“ Students Enrolled in Any Course**

```sql
SELECT Name
FROM Student S
WHERE EXISTS (
    SELECT * FROM Enrollment E 
    WHERE E.RollNo = S.RollNo
);
```

**Example â€“ Students Not Enrolled in Any Course**

```sql
SELECT Name
FROM Student S
WHERE NOT EXISTS (
    SELECT * FROM Enrollment E 
    WHERE E.RollNo = S.RollNo
);
```

---

## 4. Summary

* **Joins**: Combine tables horizontally.

  * INNER (matching only), LEFT (all from left), RIGHT (all from right), FULL (all from both), CROSS (cartesian), SELF (same table).
* **Set Operations**: Combine results vertically.

  * UNION, UNION ALL, INTERSECT, EXCEPT/MINUS.
* **Subqueries**: Queries inside queries.

  * Simple, Correlated, Inline Views, EXISTS/NOT EXISTS.

ðŸ‘‰ With these, SQL becomes extremely powerful, allowing us to query **complex relationships** in databases like **CodingGitaDB**.

---
