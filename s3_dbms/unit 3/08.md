
# GROUP BY & HAVING

## 1. Introduction

When working with large data, we often want **summarized results** instead of individual rows.

* **GROUP BY** â†’ groups rows based on one or more columns.
* **HAVING** â†’ filters groups after aggregation (similar to WHERE but applied to groups).

ðŸ‘‰ Example:

* Total number of students per city.
* Average marks per course.
* Departments with more than 5 students.

---

## 2. GROUP BY â€“ Basics

### Syntax

```sql
SELECT column, AGGREGATE_FUNCTION(column)
FROM table
GROUP BY column;
```

---

### Example 1 â€“ Count Students by City

```sql
SELECT City, COUNT(*) AS TotalStudents
FROM Student
GROUP BY City;
```

**Output**

| City      | TotalStudents |
| --------- | ------------- |
| Ahmedabad | 2             |
| Surat     | 1             |
| Rajkot    | 1             |
| Vadodara  | 1             |

ðŸ‘‰ Groups all students by **City**, then counts them.

---

### Example 2 â€“ Average Marks per Course

```sql
SELECT CourseID, AVG(Marks) AS AvgMarks
FROM Enrollment
GROUP BY CourseID;
```

**Output**

| CourseID | AvgMarks |
| -------- | -------- |
| CS101    | 88.5     |
| CS102    | 79.0     |
| CS103    | 83.5     |

---

## 3. GROUP BY with Multiple Columns

We can group by more than one column.

### Example â€“ Average Marks by Course and Semester

```sql
SELECT E.CourseID, S.Semester, AVG(E.Marks) AS AvgMarks
FROM Enrollment E
JOIN Student S ON E.RollNo = S.RollNo
GROUP BY E.CourseID, S.Semester;
```

**Output**

| CourseID | Semester | AvgMarks |
| -------- | -------- | -------- |
| CS101    | 3        | 89.0     |
| CS102    | 3        | 80.0     |
| CS103    | 3        | 84.0     |

---

## 4. HAVING â€“ Filtering Groups

The **WHERE clause filters rows before grouping**.
The **HAVING clause filters groups after grouping**.

### Example 1 â€“ Cities with More Than 1 Student

```sql
SELECT City, COUNT(*) AS TotalStudents
FROM Student
GROUP BY City
HAVING COUNT(*) > 1;
```

**Output**

| City      | TotalStudents |
| --------- | ------------- |
| Ahmedabad | 2             |

---

### Example 2 â€“ Courses with Average Marks > 80

```sql
SELECT CourseID, AVG(Marks) AS AvgMarks
FROM Enrollment
GROUP BY CourseID
HAVING AVG(Marks) > 80;
```

**Output**

| CourseID | AvgMarks |
| -------- | -------- |
| CS101    | 88.5     |
| CS103    | 83.5     |

---

### Example 3 â€“ Departments with More Than 5 Students

```sql
SELECT DeptID, COUNT(*) AS TotalStudents
FROM Student
GROUP BY DeptID
HAVING COUNT(*) > 5;
```

---

## 5. Difference Between WHERE and HAVING

| Feature            | WHERE (before grouping) | HAVING (after grouping) |
| ------------------ | ----------------------- | ----------------------- |
| Applies To         | Individual rows         | Groups (aggregates)     |
| Use With Aggregate | Not allowed             | Allowed                 |

---

### Example â€“ Using WHERE vs HAVING

**WHERE (row filter before grouping)**

```sql
SELECT City, COUNT(*)
FROM Student
WHERE Semester = 3
GROUP BY City;
```

ðŸ‘‰ Only considers students in Semester 3, then groups by City.

**HAVING (group filter after grouping)**

```sql
SELECT City, COUNT(*)
FROM Student
GROUP BY City
HAVING COUNT(*) > 2;
```

ðŸ‘‰ Groups all students by City first, then keeps only groups where count > 2.

---

## 6. Summary

* **GROUP BY** â†’ Used for grouping rows into categories.
* **Aggregate Functions** (SUM, AVG, COUNT, MIN, MAX) are often used with GROUP BY.
* **HAVING** â†’ Used to filter groups after aggregation.
* **WHERE vs HAVING** â†’ WHERE filters rows, HAVING filters groups.
* With GROUP BY + HAVING, we can write **analytical queries** like:

  * Students per city.
  * Average marks per course.
  * Departments with more than 5 students.

---
