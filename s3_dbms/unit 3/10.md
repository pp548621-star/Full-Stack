# Subqueries

## 1. Introduction

A **subquery** is a query written **inside another query**.

* Also called **nested query** or **inner query**.
* The outer query uses the result of the subquery.
* Subqueries can appear in:

  * `WHERE`
  * `FROM`
  * `SELECT`

ðŸ‘‰ In **CodingGita Portal**:

* Find students scoring **above the average marks**.
* Find courses that **no student enrolled in**.
* Find faculty teaching the **most students**.

---

## 2. Types of Subqueries

### 2.1 Single-row Subquery

Returns **only one value**.

**Example â€“ Students Above Average Marks**

```sql
SELECT S.Name, E.Marks
FROM Student S
JOIN Enrollment E ON S.RollNo = E.RollNo
WHERE E.Marks > (SELECT AVG(Marks) FROM Enrollment);
```

**Output**

| Name  | Marks |
| ----- | ----- |
| Arjun | 95    |
| Jenil | 92    |

---

### 2.2 Multi-row Subquery

Returns **multiple values**.

**Example â€“ Students Enrolled in CS101 or CS102**

```sql
SELECT Name
FROM Student
WHERE RollNo IN (
    SELECT RollNo 
    FROM Enrollment 
    WHERE CourseID IN ('CS101', 'CS102')
);
```

**Output**

| Name  |
| ----- |
| Jenil |
| Mahir |
| Arjun |

---

### 2.3 Correlated Subquery

Executed **once for each row** of outer query.

**Example â€“ Students Scoring Above Course Average**

```sql
SELECT S.Name, E.CourseID, E.Marks
FROM Student S
JOIN Enrollment E ON S.RollNo = E.RollNo
WHERE E.Marks > (
    SELECT AVG(Marks) 
    FROM Enrollment 
    WHERE CourseID = E.CourseID
);
```

ðŸ‘‰ For each course, it calculates average marks and compares studentâ€™s marks.

---

### 2.4 Subquery in FROM Clause (Inline View)

Subquery is used as a **temporary table**.

**Example â€“ Courses with Average Marks Above 80**

```sql
SELECT CourseID, AvgMarks
FROM (
    SELECT CourseID, AVG(Marks) AS AvgMarks
    FROM Enrollment
    GROUP BY CourseID
) AS CourseStats
WHERE AvgMarks > 80;
```

**Output**

| CourseID | AvgMarks |
| -------- | -------- |
| CS101    | 88.5     |
| CS103    | 83.5     |

---

### 2.5 Subquery in SELECT Clause

Used to return calculated values in output.

**Example â€“ Each Studentâ€™s Marks vs Overall Average**

```sql
SELECT S.Name, E.Marks,
       (SELECT AVG(Marks) FROM Enrollment) AS OverallAvg
FROM Student S
JOIN Enrollment E ON S.RollNo = E.RollNo;
```

**Output**

| Name   | Marks | OverallAvg |
| ------ | ----- | ---------- |
| Jenil  | 92    | 84.3       |
| Mahir  | 76    | 84.3       |
| Arjun  | 95    | 84.3       |
| Yashvi | 85    | 84.3       |

---

### 2.6 EXISTS and NOT EXISTS

* **EXISTS** â†’ Checks if subquery returns at least one row.
* **NOT EXISTS** â†’ Checks if subquery returns no rows.

**Example â€“ Students Enrolled in Any Course**

```sql
SELECT Name
FROM Student S
WHERE EXISTS (
    SELECT * FROM Enrollment E 
    WHERE E.RollNo = S.RollNo
);
```

**Output**

| Name   |
| ------ |
| Jenil  |
| Mahir  |
| Arjun  |
| Yashvi |

---

**Example â€“ Students Not Enrolled in Any Course**

```sql
SELECT Name
FROM Student S
WHERE NOT EXISTS (
    SELECT * FROM Enrollment E 
    WHERE E.RollNo = S.RollNo
);
```

ðŸ‘‰ Returns only students with **no enrollment records**.

---

## 3. Subquery vs Joins

| Feature     | Subquery                       | Join                      |
| ----------- | ------------------------------ | ------------------------- |
| Approach    | Inner query inside outer query | Combines tables directly  |
| Performance | Sometimes slower               | Often faster              |
| Readability | Easier for conditions          | Better for combining data |

ðŸ‘‰ Example: Finding students with marks above average â†’ easier with **subquery**, but large dataset queries may run faster with **joins**.

---

## 4. Summary

* **Subqueries** allow nesting queries inside queries.
* **Single-row** â†’ returns one value.
* **Multi-row** â†’ returns multiple values (IN, ANY, ALL).
* **Correlated** â†’ executed for each outer row.
* **FROM Subquery** â†’ acts as inline table.
* **SELECT Subquery** â†’ returns calculated values.
* **EXISTS/NOT EXISTS** â†’ check for presence/absence of rows.
* Used in CodingGita DB to check enrollment, averages, and course-level performance.

---
