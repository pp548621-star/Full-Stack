# 📘 MongoDB Assignment – Answer Book

## Section A. CRUD Basics (Answers)

**Q1. Insert a new company "Tesla"**

```javascript
db.companies.insertOne({
  name: "Tesla",
  location: "Bangalore",
  salaryBand: { base: 29, bonus: 4, stock: 6 },
  hiringCriteria: { cgpa: 7.0, skills: ["DSA", "Python", "Distributed Systems"], experience: "1-2 years" },
  interviewRounds: [
    { round: 1, type: "OA" },
    { round: 2, type: "Technical" },
    { round: 3, type: "HR" }
  ],
  benefits: ["Relocation", "WFH"],
  headcount: 800
})
```

✅ Inserts Tesla into dataset.

---

**Q2. Insert multiple companies ("Stripe", "Coinbase")**

```javascript
db.companies.insertMany([
  { name: "Stripe", location: "Bangalore", salaryBand: { base: 40, bonus: 8, stock: 12 } },
  { name: "Coinbase", location: "Hyderabad", salaryBand: { base: 38, bonus: 6, stock: 15 } }
])
```

✅ Two new docs inserted.

---

**Q3. Find all companies**

```javascript
db.companies.find()
```

✅ Returns all 20+ inserted docs.

---

**Q4. Find one company in Bangalore**

```javascript
db.companies.findOne({ location: "Bangalore" })
```

✅ Likely returns `Google` or `Meta` depending on order.

---

**Q5. Companies with base > 30 LPA**

```javascript
db.companies.find({ "salaryBand.base": { $gt: 30 } })
```

✅ Expected: Microsoft, Meta, Apple, Netflix, Stripe, Coinbase.

---

**Q6. Companies in Hyderabad**

```javascript
db.companies.find({ location: "Hyderabad" })
```

✅ Expected: Amazon, Microsoft, Apple, Salesforce, Coinbase.

---

**Q7. CGPA requirement >= 8.0**

```javascript
db.companies.find({ "hiringCriteria.cgpa": { $gte: 8.0 } })
```

✅ Expected: Microsoft, Meta, Apple, Atlassian.

---

**Q8. Companies requiring "System Design"**

```javascript
db.companies.find({ "hiringCriteria.skills": "System Design" })
```

✅ Expected: Google, Microsoft, Meta, Flipkart, Atlassian.

---

**Q9. Companies offering "Relocation"**

```javascript
db.companies.find({ benefits: "Relocation" })
```

✅ Expected: Google, Apple, Uber, Ola, Infosys, Goldman Sachs, Tesla.

---

**Q10. Companies with stock >= 15**

```javascript
db.companies.find({ "salaryBand.stock": { $gte: 15 } })
```

✅ Expected: Microsoft, Meta, Apple, Coinbase.

---

**Q11. At least 4 interview rounds**

```javascript
db.companies.find({ "interviewRounds.3": { $exists: true } })
```

✅ Expected: Google, Amazon, Microsoft, Meta, Apple, Salesforce, Uber, Flipkart, Atlassian, Goldman Sachs.

---

**Q12. Headcount > 5000**

```javascript
db.companies.find({ headcount: { $gt: 5000 } })
```

✅ Expected: Amazon, Infosys, TCS Digital.

---

**Q13. Insert company with only `name`, `location`**

```javascript
db.companies.insertOne({ name: "Freshworks", location: "Chennai" })
```

✅ Document inserted with minimal fields.

---

**Q14. Update Amazon’s bonus to 6**

```javascript
db.companies.updateOne(
  { name: "Amazon" },
  { $set: { "salaryBand.bonus": 6 } }
)
```

✅ Amazon’s bonus updated.

---

**Q15. Add "Free Snacks" to all Hyderabad companies**

```javascript
db.companies.updateMany(
  { location: "Hyderabad" },
  { $addToSet: { benefits: "Free Snacks" } }
)
```

✅ 5 companies updated.

---

**Q16. Add skill "Python" to Google**

```javascript
db.companies.updateOne(
  { name: "Google" },
  { $addToSet: { "hiringCriteria.skills": "Python" } }
)
```

---

**Q17. Remove "Gym" from Microsoft**

```javascript
db.companies.updateOne(
  { name: "Microsoft" },
  { $pull: { benefits: "Gym" } }
)
```

---

**Q18. Replace salaryBand for Netflix**

```javascript
db.companies.updateOne(
  { name: "Netflix" },
  { $set: { salaryBand: { base: 40, bonus: 8, stock: 20 } } }
)
```

---

**Q19. Delete Infosys**

```javascript
db.companies.deleteOne({ name: "Infosys" })
```

---

**Q20. Delete all companies base < 10**

```javascript
db.companies.deleteMany({ "salaryBand.base": { $lt: 10 } })
```

✅ Removes TCS Digital and Infosys.

---

**Q21. Add field isTopTier to Google**

```javascript
db.companies.updateOne(
  { name: "Google" },
  { $set: { isTopTier: true } }
)
```

---

**Q22. Increase Amazon’s stock by 2**

```javascript
db.companies.updateOne(
  { name: "Amazon" },
  { $inc: { "salaryBand.stock": 2 } }
)
```

---

**Q23. Rename headcount → employeeCount**

```javascript
db.companies.updateMany({}, { $rename: { headcount: "employeeCount" } })
```

---

**Q24. Remove bonus from salaryBand**

```javascript
db.companies.updateMany({}, { $unset: { "salaryBand.bonus": "" } })
```

---

**Q25. Insert 5 dummy companies**

```javascript
db.companies.insertMany([
  { name: "Dummy1" },
  { name: "Dummy2" },
  { name: "Dummy3" },
  { name: "Dummy4" },
  { name: "Dummy5" }
])
```

---

**Q26. Delete all dummy companies**

```javascript
db.companies.deleteMany({ name: { $regex: /^Dummy/ } })
```

---

**Q27. Project only name & salaryBand**

```javascript
db.companies.find({}, { name: 1, salaryBand: 1 })
```

---

**Q28. Exclude `_id`**

```javascript
db.companies.find({}, { _id: 0, name: 1, location: 1 })
```

---

**Q29. Microsoft name + benefits only**

```javascript
db.companies.find({ name: "Microsoft" }, { name: 1, benefits: 1 })
```

---

**Q30. Count Bangalore companies**

```javascript
db.companies.countDocuments({ location: "Bangalore" })
```

✅ Should be \~8.

---

**Q31. Count CGPA >= 7.0**

```javascript
db.companies.countDocuments({ "hiringCriteria.cgpa": { $gte: 7.0 } })
```

---

**Q32. Distinct locations**

```javascript
db.companies.distinct("location")
```

✅ \["Bangalore", "Hyderabad", "Noida", "Mumbai", "Pune", "Mysore", "Chennai", "Gurgaon"]

---

**Q33. Distinct benefits**

```javascript
db.companies.distinct("benefits")
```

✅ \["Relocation","WFH","Stock Options","Health Insurance","Free Meals","Device Discounts","Training",...]

---

**Q34. Any company stock = 20**

```javascript
db.companies.findOne({ "salaryBand.stock": 20 })
```

✅ Meta or Apple matches.

---

**Q35. Insert nested perks**

```javascript
db.companies.updateOne(
  { name: "Swiggy" },
  { $set: { perks: { transport: true } } }
)
```

---

**Q36. Push new round in Meta**

```javascript
db.companies.updateOne(
  { name: "Meta" },
  { $push: { interviewRounds: { round: 5, type: "CTO Interview" } } }
)
```

---

**Q37. Remove "HR" round from Amazon**

```javascript
db.companies.updateOne(
  { name: "Amazon" },
  { $pull: { interviewRounds: { type: "HR" } } }
)
```

---

**Q38. Add "Health Insurance" if not exists in Swiggy**

```javascript
db.companies.updateOne(
  { name: "Swiggy" },
  { $addToSet: { benefits: "Health Insurance" } }
)
```

---

**Q39. Increase base salary by 2 for Bangalore companies**

```javascript
db.companies.updateMany(
  { location: "Bangalore" },
  { $inc: { "salaryBand.base": 2 } }
)
```

---

**Q40. Delete Delhi companies**

```javascript
db.companies.deleteMany({ location: "Delhi" })
```

✅ (No match in our dataset, returns 0).

---

# 📘 MongoDB Answer Book (Q41–Q100)


## Section B. Advanced Queries


**Q41. Companies with base between 25–35**

```javascript
db.companies.find({ "salaryBand.base": { $gte: 25, $lte: 35 } })
```

✅ Matches: Google (30), Amazon (28), Microsoft (32), Apple (33), Salesforce (29), Uber (27), Flipkart (26), Walmart Labs (24 → no, just below).

---

**Q42. Companies with stock < 10**

```javascript
db.companies.find({ "salaryBand.stock": { $lt: 10 } })
```

✅ Matches: Adobe (8), Salesforce (9), Swiggy (5), Zomato (4), Ola (6), Flipkart (7), Walmart Labs (7), Paytm (3), Goldman Sachs (8).

---

**Q43. Bonus > 5 AND stock > 10**

```javascript
db.companies.find({ "salaryBand.bonus": { $gt: 5 }, "salaryBand.stock": { $gt: 10 } })
```

✅ Matches: Microsoft, Meta, Netflix, Coinbase.

---

**Q44. Base >= 30 OR stock >= 12**

```javascript
db.companies.find({
  $or: [
    { "salaryBand.base": { $gte: 30 } },
    { "salaryBand.stock": { $gte: 12 } }
  ]
})
```

✅ Matches: Google, Microsoft, Meta, Apple, Netflix, Stripe, Coinbase, Amazon (stock 12).

---

**Q45. Companies NOT requiring "OS"**

```javascript
db.companies.find({ "hiringCriteria.skills": { $ne: "OS" } })
```

✅ Excludes Amazon, Apple.

---

**Q46. At least one skill from \["Java", "C++"]**

```javascript
db.companies.find({ "hiringCriteria.skills": { $in: ["Java", "C++"] } })
```

✅ Matches: Google, Amazon, Microsoft, Apple, Netflix, Adobe, Salesforce, Uber, Flipkart, Infosys, TCS Digital, Walmart Labs, Goldman Sachs.

---

**Q47. Must require BOTH "DSA" and "System Design"**

```javascript
db.companies.find({ "hiringCriteria.skills": { $all: ["DSA", "System Design"] } })
```

✅ Matches: Google, Microsoft, Meta, Flipkart, Atlassian.

---

**Q48. Companies not offering WFH**

```javascript
db.companies.find({ benefits: { $ne: "WFH" } })
```

✅ Excludes Google, Amazon, Netflix, Adobe, Swiggy, Flipkart, TCS Digital.

---

**Q49. Companies with >3 benefits**

```javascript
db.companies.find({ benefits: { $exists: true, $size: { $gt: 3 } } })
```

⚠️ `$size` doesn’t allow `$gt` → must use aggregation.

```javascript
db.companies.aggregate([
  { $project: { name: 1, benefitCount: { $size: "$benefits" } } },
  { $match: { benefitCount: { $gt: 3 } } }
])
```

✅ Likely: Google, Meta, Microsoft.

---

**Q50. Exactly 4 interview rounds**

```javascript
db.companies.find({ "interviewRounds.3": { $exists: true }, "interviewRounds.4": { $exists: false } })
```

✅ Matches: Google, Amazon, Microsoft, Meta, Apple, Salesforce, Uber, Flipkart, Atlassian, Goldman Sachs.

---

**Q51. Employee count > 2000**

```javascript
db.companies.find({ employeeCount: { $gt: 2000 } })
```

✅ Matches: Amazon, Microsoft, Apple, Salesforce, Flipkart, Infosys, TCS Digital, Walmart Labs, Paytm.

---

**Q52. Salaries in multiples of 5**

```javascript
db.companies.find({ "salaryBand.base": { $mod: [5, 0] } })
```

✅ Matches: Google (30), Amazon (28 → no), Microsoft (32 → no), Meta (35), Apple (33 → no), Netflix (38 → no), Stripe (40), Coinbase (38 → no), Infosys (6 → no), TCS (7 → no).

---

**Q53. CGPA in \[6.5, 7.0, 7.5]**

```javascript
db.companies.find({ "hiringCriteria.cgpa": { $in: [6.5, 7.0, 7.5] } })
```

✅ Matches: Amazon (7.0), Adobe (7.0), Salesforce (7.5), Swiggy (6.5), Zomato (6.5), Ola (7.0), Walmart Labs (7.0), Paytm (6.5), Goldman Sachs (7.5).

---

**Q54. Companies NOT in Bangalore**

```javascript
db.companies.find({ location: { $ne: "Bangalore" } })
```

✅ Matches: Amazon, Microsoft, Apple, Netflix, Adobe, Salesforce, Infosys, TCS Digital, Paytm, Zomato.

---

**Q55. Skills ending with "Design"**

```javascript
db.companies.find({ "hiringCriteria.skills": { $regex: /Design$/ } })
```

✅ Matches: Google, Microsoft, Meta, Flipkart, Atlassian.

---

**Q56. Companies starting with "A"**

```javascript
db.companies.find({ name: { $regex: /^A/ } })
```

✅ Matches: Amazon, Apple, Adobe, Atlassian.

---

**Q57. Case-insensitive search "amazon"**

```javascript
db.companies.find({ name: { $regex: /^amazon$/i } })
```

✅ Returns Amazon.

---

**Q58. Where stock field exists**

```javascript
db.companies.find({ "salaryBand.stock": { $exists: true } })
```

✅ Matches: All except Infosys, TCS Digital (stock = 0 still exists → matches).

---

**Q59. Where perks field does NOT exist**

```javascript
db.companies.find({ perks: { $exists: false } })
```

✅ All except Swiggy (we added perks earlier).

---

**Q60. Salary base must be a number**

```javascript
db.companies.find({ "salaryBand.base": { $type: "number" } })
```

✅ Matches: All companies.

---

**Q61. Sort base ascending**

```javascript
db.companies.find().sort({ "salaryBand.base": 1 })
```

✅ Lowest = Infosys (6), highest = Stripe (40).

---

**Q62. Sort base descending**

```javascript
db.companies.find().sort({ "salaryBand.base": -1 })
```

✅ Reverse order.

---

**Q63. Sort by bonus then stock**

```javascript
db.companies.find().sort({ "salaryBand.bonus": 1, "salaryBand.stock": 1 })
```

---

**Q64. Limit to top 5 highest base**

```javascript
db.companies.find().sort({ "salaryBand.base": -1 }).limit(5)
```

✅ Stripe (40), Netflix (38), Coinbase (38), Meta (35), Apple (33).

---

**Q65. Skip first 5 and return next 5**

```javascript
db.companies.find().sort({ "salaryBand.base": -1 }).skip(5).limit(5)
```

---

**Q66. Company with maximum base**

```javascript
db.companies.find().sort({ "salaryBand.base": -1 }).limit(1)
```

✅ Stripe.

---

**Q67. Company with minimum CGPA**

```javascript
db.companies.find().sort({ "hiringCriteria.cgpa": 1 }).limit(1)
```

✅ Infosys / TCS Digital (6.0).

---

**Q68. First 3 alphabetically**

```javascript
db.companies.find().sort({ name: 1 }).limit(3)
```

✅ Adobe, Amazon, Apple.

---

**Q69. Companies with "Technical" round**

```javascript
db.companies.find({ "interviewRounds.type": "Technical" })
```

✅ Many, e.g. Google, Microsoft, Adobe, Flipkart.

---

**Q70. Round 2 = "System Design"**

```javascript
db.companies.find({ "interviewRounds.1.type": "System Design" })
```

✅ Uber, Meta, Amazon.

---

**Q71. InterviewRounds length > 3**

```javascript
db.companies.find({ "interviewRounds.3": { $exists: true } })
```

✅ Google, Amazon, Microsoft, Meta, Apple, Salesforce, Uber, Flipkart, Atlassian, Goldman Sachs.

---

**Q72. Second benefit = "WFH"**

```javascript
db.companies.find({ "benefits.1": "WFH" })
```

✅ Amazon, Adobe, Flipkart, TCS Digital.

---

**Q73. Must have \["DSA", "Java"]**

```javascript
db.companies.find({ "hiringCriteria.skills": { $all: ["DSA", "Java"] } })
```

✅ Matches: Google, Amazon, Salesforce, Uber, Flipkart, Infosys, Walmart Labs, Atlassian, Goldman Sachs.

---

**Q74. SalaryBand elemMatch (base > 25 and stock > 5)**

```javascript
db.companies.find({ salaryBand: { $elemMatch: { base: { $gt: 25 }, stock: { $gt: 5 } } } })
```

⚠️ `salaryBand` is an object, not array → directly query:

```javascript
db.companies.find({ "salaryBand.base": { $gt: 25 }, "salaryBand.stock": { $gt: 5 } })
```

---

**Q75. Location in \[Hyderabad, Bangalore]**

```javascript
db.companies.find({ location: { $in: ["Hyderabad", "Bangalore"] } })
```

---

**Q76. Location not in \[Mumbai, Pune]**

```javascript
db.companies.find({ location: { $nin: ["Mumbai", "Pune"] } })
```

---

**Q77. Base closest to 30**

```javascript
db.companies.aggregate([
  { $project: { name: 1, base: "$salaryBand.base", diff: { $abs: { $subtract: ["$salaryBand.base", 30] } } } },
  { $sort: { diff: 1 } },
  { $limit: 1 }
])
```

✅ Google (30 exactly).

---

**Q78. Exclude salaries < 20**

```javascript
db.companies.find({ "salaryBand.base": { $not: { $lt: 20 } } })
```

---

**Q79. Bonus < base/10**

```javascript
db.companies.find({ $expr: { $lt: ["$salaryBand.bonus", { $divide: ["$salaryBand.base", 10] }] } })
```

---

**Q80. Exactly 2 benefits**

```javascript
db.companies.find({ benefits: { $size: 2 } })
```

✅ Matches: Apple, Uber, Ola, Paytm.

---

**Q81. Project totalComp**

```javascript
db.companies.aggregate([
  { $project: { name: 1, totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } }
])
```

---

**Q82. totalComp > 45**

```javascript
db.companies.aggregate([
  { $project: { name: 1, totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $match: { totalComp: { $gt: 45 } } }
])
```

✅ Matches: Meta, Stripe.

---

**Q83. Sort by totalComp**

```javascript
db.companies.aggregate([
  { $project: { name: 1, totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $sort: { totalComp: -1 } }
])
```

---

**Q84. Multiply stock by 2**

```javascript
db.companies.updateMany({}, { $mul: { "salaryBand.stock": 2 } })
```

---

**Q85. Ensure bonus >= 5**

```javascript
db.companies.updateMany({}, { $max: { "salaryBand.bonus": 5 } })
```

---

**Q86. Cap base at 35**

```javascript
db.companies.updateMany({}, { $min: { "salaryBand.base": 35 } })
```

---

**Q87. Ensure unique WFH**

```javascript
db.companies.updateMany({}, { $addToSet: { benefits: "WFH" } })
```

---

**Q88. Array filter → change 3rd round**

```javascript
db.companies.updateMany(
  {},
  { $set: { "interviewRounds.$[elem].type": "Tech Screen" } },
  { arrayFilters: [{ "elem.round": 3 }] }
)
```

---

**Q89. Add currentDate**

```javascript
db.companies.updateMany({}, { $currentDate: { lastUpdated: true } })
```

---

**Q90. Delete companies without benefits**

```javascript
db.companies.deleteMany({ benefits: { $exists: false } })
```

---

**Q91. Upsert Tesla**

```javascript
db.companies.updateOne(
  { name: "Tesla" },
  { $set: { location: "Bangalore" } },
  { upsert: true }
)
```

---

**Q92. Exclude salaryBand**

```javascript
db.companies.find({}, { salaryBand: 0 })
```

---

**Q93. Project doubleStock**

```javascript
db.companies.aggregate([
  { $project: { name: 1, doubleStock: { $multiply: ["$salaryBand.stock", 2] } } }
])
```

---

**Q94. Name length = 6**

```javascript
db.companies.find({ $expr: { $eq: [{ $strLenCP: "$name" }, 6] } })
```

✅ Matches: Amazon, Google.

---

**Q95. base % 2 = 0**

```javascript
db.companies.find({ "salaryBand.base": { $mod: [2, 0] } })
```

---

**Q96. headcount > 2000 (\$where)**

```javascript
db.companies.find({ $where: "this.employeeCount > 2000" })
```

---

**Q97. Text search "Java"**
(First, index on skills)

```javascript
db.companies.createIndex({ "hiringCriteria.skills": "text" })
db.companies.find({ $text: { $search: "Java" } })
```

---

**Q98. Case-insensitive sort**

```javascript
db.companies.find().collation({ locale: "en", strength: 2 }).sort({ name: 1 })
```

---

**Q99. Benefits type = array**

```javascript
db.companies.find({ benefits: { $type: "array" } })
```

---

**Q100. Benefits include "Free Meals"**

```javascript
db.companies.find({ benefits: "Free Meals" })
```

✅ Matches: Meta, Salesforce, Swiggy.

---

# 📘 MongoDB Answer Book (Q101–Q200)


## Section C. Aggregation Queries (Part 1)



**Q101. Match companies with base ≥ 30**

```javascript
db.companies.aggregate([
  { $match: { "salaryBand.base": { $gte: 30 } } }
])
```

✅ Returns Google, Microsoft, Meta, Apple, Netflix, Stripe, Coinbase.

---

**Q102. Project only name + base**

```javascript
db.companies.aggregate([
  { $project: { name: 1, base: "$salaryBand.base" } }
])
```

✅ Example output: `{ name: "Google", base: 30 }`.

---

**Q103. Add computed field `totalComp`**

```javascript
db.companies.aggregate([
  { $project: { name: 1, totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } }
])
```

✅ Example: Google → `30+5+10=45`.

---

**Q104. Group: average base per location**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", avgBase: { $avg: "$salaryBand.base" } } }
])
```

✅ Returns: Bangalore \~28, Hyderabad \~30, etc.

---

**Q105. Group: maximum base per company**

```javascript
db.companies.aggregate([
  { $group: { _id: "$name", maxBase: { $max: "$salaryBand.base" } } }
])
```

✅ Each company’s base salary since each doc = one value.

---

**Q106. Group: minimum CGPA per location**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", minCgpa: { $min: "$hiringCriteria.cgpa" } } }
])
```

---

**Q107. Group: total headcount per location**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", totalEmployees: { $sum: "$employeeCount" } } }
])
```

---

**Q108. Sort by base salary ascending**

```javascript
db.companies.aggregate([{ $sort: { "salaryBand.base": 1 } }])
```

✅ Lowest: Infosys (6), TCS Digital (7).

---

**Q109. Sort by computed totalComp**

```javascript
db.companies.aggregate([
  { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $sort: { totalComp: -1 } }
])
```

✅ Highest: Stripe, Meta, Coinbase.

---

**Q110. Limit to top 3 highest base**

```javascript
db.companies.aggregate([
  { $sort: { "salaryBand.base": -1 } },
  { $limit: 3 }
])
```

✅ Stripe (40), Netflix (38), Coinbase (38).

---

**Q111. Skip first 5**

```javascript
db.companies.aggregate([
  { $sort: { "salaryBand.base": -1 } },
  { $skip: 5 }
])
```

---

**Q112. Count companies in Bangalore**

```javascript
db.companies.aggregate([
  { $match: { location: "Bangalore" } },
  { $count: "bangaloreCompanies" }
])
```

✅ Should be \~8.

---

**Q113. Unwind benefits**

```javascript
db.companies.aggregate([
  { $unwind: "$benefits" }
])
```

✅ Expands each company into multiple docs, one per benefit.

---

**Q114. Group: count of each benefit**

```javascript
db.companies.aggregate([
  { $unwind: "$benefits" },
  { $group: { _id: "$benefits", count: { $sum: 1 } } },
  { $sort: { count: -1 } }
])
```

✅ Most common: "Health Insurance", "WFH".

---

**Q115. Unwind interviewRounds**

```javascript
db.companies.aggregate([
  { $unwind: "$interviewRounds" }
])
```

✅ Expands one company → one row per round.

---

**Q116. Group: count each interview type**

```javascript
db.companies.aggregate([
  { $unwind: "$interviewRounds" },
  { $group: { _id: "$interviewRounds.type", count: { $sum: 1 } } },
  { $sort: { count: -1 } }
])
```

✅ Likely most common: "Technical".

---

**Q117. Lookup: join with candidates**
(Assume `candidates` collection exists with `companyName`)

```javascript
db.companies.aggregate([
  { $lookup: { from: "candidates", localField: "name", foreignField: "companyName", as: "applicants" } }
])
```

---

**Q118. Facet pipeline**

```javascript
db.companies.aggregate([
  {
    $facet: {
      salaries: [{ $group: { _id: null, avgBase: { $avg: "$salaryBand.base" } } }],
      benefits: [{ $unwind: "$benefits" }, { $group: { _id: "$benefits", count: { $sum: 1 } } }]
    }
  }
])
```

✅ Returns two arrays in one doc.

---

**Q119. Bucket salaries into ranges**

```javascript
db.companies.aggregate([
  {
    $bucket: {
      groupBy: "$salaryBand.base",
      boundaries: [0, 10, 20, 30, 40, 50],
      default: "Other",
      output: { count: { $sum: 1 } }
    }
  }
])
```

---

**Q120. BucketAuto salaries into 4 groups**

```javascript
db.companies.aggregate([
  { $bucketAuto: { groupBy: "$salaryBand.base", buckets: 4 } }
])
```

---

**Q121. Match companies with Stock Options benefit**

```javascript
db.companies.aggregate([{ $match: { benefits: "Stock Options" } }])
```

✅ Matches: Amazon, Microsoft, Meta, Salesforce, Flipkart, Walmart Labs, Atlassian.

---

**Q122. Project hide headcount**

```javascript
db.companies.aggregate([{ $project: { employeeCount: 0 } }])
```

---

**Q123. Project boolean field isHighPaying**

```javascript
db.companies.aggregate([
  { $project: { name: 1, isHighPaying: { $gte: ["$salaryBand.base", 30] } } }
])
```

---

**Q124. Group: avg stock by location**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", avgStock: { $avg: "$salaryBand.stock" } } }
])
```

---

**Q125. Group: totalComp sum per company**

```javascript
db.companies.aggregate([
  { $project: { name: 1, totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $group: { _id: "$name", companyTotal: { $sum: "$totalComp" } } }
])
```

✅ Same as projected totalComp since one doc = one company.

---

**Q126. Sort by CGPA requirement descending**

```javascript
db.companies.aggregate([{ $sort: { "hiringCriteria.cgpa": -1 } }])
```

✅ Top: Meta (8.5).

---

**Q127. Avg salary only in Hyderabad**

```javascript
db.companies.aggregate([
  { $match: { location: "Hyderabad" } },
  { $group: { _id: null, avgSalary: { $avg: "$salaryBand.base" } } }
])
```

---

**Q128. Lookup: Student ↔ Course (if other collection exists)**

```javascript
db.students.aggregate([
  { $lookup: { from: "courses", localField: "enrolledCourses", foreignField: "_id", as: "courseDetails" } }
])
```

---

**Q129. Lookup: Post ↔ User (if blog schema exists)**

```javascript
db.posts.aggregate([
  { $lookup: { from: "users", localField: "author", foreignField: "_id", as: "authorDetails" } }
])
```

---

**Q130. ReplaceRoot to flatten salaryBand**

```javascript
db.companies.aggregate([
  { $replaceRoot: { newRoot: { $mergeObjects: ["$salaryBand", "$$ROOT"] } } }
])
```

✅ Brings base/bonus/stock to root level.

---

**Q131. Add total in salaryBand**

```javascript
db.companies.aggregate([
  { $set: { "salaryBand.total": { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } }
])
```

---

**Q132. Add skillCount field**

```javascript
db.companies.aggregate([
  { $addFields: { skillCount: { $size: "$hiringCriteria.skills" } } }
])
```

---

**Q133. Match companies with >2 skills**

```javascript
db.companies.aggregate([
  { $addFields: { skillCount: { $size: "$hiringCriteria.skills" } } },
  { $match: { skillCount: { $gt: 2 } } }
])
```

✅ Matches: Google, Microsoft, Meta, etc.

---

**Q134. Group: number of companies per skill**

```javascript
db.companies.aggregate([
  { $unwind: "$hiringCriteria.skills" },
  { $group: { _id: "$hiringCriteria.skills", count: { $sum: 1 } } }
])
```

---

**Q135. Unwind skills**

```javascript
db.companies.aggregate([{ $unwind: "$hiringCriteria.skills" }])
```

---

**Q136. Group: skill popularity**

```javascript
db.companies.aggregate([
  { $unwind: "$hiringCriteria.skills" },
  { $group: { _id: "$hiringCriteria.skills", total: { $sum: 1 } } },
  { $sort: { total: -1 } }
])
```

✅ Most popular: "DSA".

---

**Q137. Sort skill popularity descending**
(Already done above).

---

**Q138. Lookup: join companies with interview database**

```javascript
db.companies.aggregate([
  { $lookup: { from: "interviews", localField: "name", foreignField: "companyName", as: "interviewDetails" } }
])
```

---

**Q139. Cond → tag premium if base > 30**

```javascript
db.companies.aggregate([
  { $project: { name: 1, premium: { $cond: [{ $gt: ["$salaryBand.base", 30] }, true, false] } } }
])
```

---

**Q140. IfNull: set bonus = 0 if missing**

```javascript
db.companies.aggregate([
  { $project: { name: 1, bonus: { $ifNull: ["$salaryBand.bonus", 0] } } }
])
```

---

**Q141. Switch: assign rating**

```javascript
db.companies.aggregate([
  {
    $project: {
      name: 1,
      rating: {
        $switch: {
          branches: [
            { case: { $gte: ["$salaryBand.base", 35] }, then: "Platinum" },
            { case: { $gte: ["$salaryBand.base", 30] }, then: "Gold" },
            { case: { $gte: ["$salaryBand.base", 20] }, then: "Silver" }
          ],
          default: "Bronze"
        }
      }
    }
  }
])
```

---

**Q142. RegexMatch for names ending in "s"**

```javascript
db.companies.aggregate([
  { $match: { name: { $regex: /s$/ } } }
])
```

✅ Matches: Infosys, TCS Digital, Goldman Sachs.

---

**Q143. Merge results into new collection**

```javascript
db.companies.aggregate([
  { $project: { name: 1, base: "$salaryBand.base" } },
  { $merge: "salaryAnalysis" }
])
```

---

**Q144. Out → write to new collection**

```javascript
db.companies.aggregate([
  { $match: { "salaryBand.base": { $gt: 30 } } },
  { $out: "highSalaryCompanies" }
])
```

---

**Q145. Group: total base per benefit**

```javascript
db.companies.aggregate([
  { $unwind: "$benefits" },
  { $group: { _id: "$benefits", totalBase: { $sum: "$salaryBand.base" } } }
])
```

---

**Q146. Group: count companies with WFH**

```javascript
db.companies.aggregate([
  { $match: { benefits: "WFH" } },
  { $count: "companiesWithWFH" }
])
```

---

**Q147. Sort: companies with most benefits**

```javascript
db.companies.aggregate([
  { $project: { name: 1, benefitCount: { $size: "$benefits" } } },
  { $sort: { benefitCount: -1 } }
])
```

---

**Q148. Unwind + group: avg CGPA per skill**

```javascript
db.companies.aggregate([
  { $unwind: "$hiringCriteria.skills" },
  { $group: { _id: "$hiringCriteria.skills", avgCgpa: { $avg: "$hiringCriteria.cgpa" } } }
])
```

---

**Q149. Avg interview rounds per location**

```javascript
db.companies.aggregate([
  { $project: { location: 1, roundsCount: { $size: "$interviewRounds" } } },
  { $group: { _id: "$location", avgRounds: { $avg: "$roundsCount" } } }
])
```

---

**Q150. Count number of interview types across dataset**

```javascript
db.companies.aggregate([
  { $unwind: "$interviewRounds" },
  { $group: { _id: "$interviewRounds.type" } },
  { $count: "uniqueInterviewTypes" }
])
```

---

**Q151. Group by location: total companies & avg base**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", totalCompanies: { $sum: 1 }, avgBase: { $avg: "$salaryBand.base" } } }
])
```

---

**Q152. Find top 3 locations by avg salary**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", avgBase: { $avg: "$salaryBand.base" } } },
  { $sort: { avgBase: -1 } },
  { $limit: 3 }
])
```

---

**Q153. Skill demand: top 5 skills required**

```javascript
db.companies.aggregate([
  { $unwind: "$hiringCriteria.skills" },
  { $group: { _id: "$hiringCriteria.skills", count: { $sum: 1 } } },
  { $sort: { count: -1 } },
  { $limit: 5 }
])
```

✅ Expected top skill: DSA.

---

**Q154. Average stock + bonus combined per location**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", avgExtra: { $avg: { $add: ["$salaryBand.stock", "$salaryBand.bonus"] } } } }
])
```

---

**Q155. Top 5 companies by totalComp**

```javascript
db.companies.aggregate([
  { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $sort: { totalComp: -1 } },
  { $limit: 5 }
])
```

✅ Expected: Stripe, Meta, Coinbase, Netflix, Apple.

---

**Q156. Count companies requiring System Design skill**

```javascript
db.companies.aggregate([
  { $match: { "hiringCriteria.skills": "System Design" } },
  { $count: "systemDesignCompanies" }
])
```

---

**Q157. Avg CGPA requirement grouped by skill**

```javascript
db.companies.aggregate([
  { $unwind: "$hiringCriteria.skills" },
  { $group: { _id: "$hiringCriteria.skills", avgCgpa: { $avg: "$hiringCriteria.cgpa" } } }
])
```

---

**Q158. Companies with >2 benefits, sorted**

```javascript
db.companies.aggregate([
  { $project: { name: 1, benefitCount: { $size: "$benefits" } } },
  { $match: { benefitCount: { $gt: 2 } } },
  { $sort: { benefitCount: -1 } }
])
```

---

**Q159. For each company, show name + total interview rounds**

```javascript
db.companies.aggregate([
  { $project: { name: 1, totalRounds: { $size: "$interviewRounds" } } }
])
```

---

**Q160. Most common interview round type overall**

```javascript
db.companies.aggregate([
  { $unwind: "$interviewRounds" },
  { $group: { _id: "$interviewRounds.type", count: { $sum: 1 } } },
  { $sort: { count: -1 } },
  { $limit: 1 }
])
```

✅ Likely “Technical”.

---

**Q161. Group companies into salary bands (<=10, 11–20, 21–30, >30)**

```javascript
db.companies.aggregate([
  {
    $bucket: {
      groupBy: "$salaryBand.base",
      boundaries: [0, 11, 21, 31, 100],
      default: "Other",
      output: { count: { $sum: 1 } }
    }
  }
])
```

---

**Q162. Split companies by cgpa ≥ 8 vs < 8**

```javascript
db.companies.aggregate([
  {
    $facet: {
      highCgpa: [{ $match: { "hiringCriteria.cgpa": { $gte: 8 } } }],
      lowCgpa: [{ $match: { "hiringCriteria.cgpa": { $lt: 8 } } }]
    }
  }
])
```

---

**Q163. Average totalComp per location**

```javascript
db.companies.aggregate([
  { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $group: { _id: "$location", avgTotal: { $avg: "$totalComp" } } }
])
```

---

**Q164. Median salary using \$bucketAuto (approx)**

```javascript
db.companies.aggregate([
  { $bucketAuto: { groupBy: "$salaryBand.base", buckets: 2 } }
])
```

✅ Splits into two halves → median approx at boundary.

---

**Q165. Average base salary per benefit**

```javascript
db.companies.aggregate([
  { $unwind: "$benefits" },
  { $group: { _id: "$benefits", avgBase: { $avg: "$salaryBand.base" } } }
])
```

---

**Q166. Skill frequency by location**

```javascript
db.companies.aggregate([
  { $unwind: "$hiringCriteria.skills" },
  { $group: { _id: { location: "$location", skill: "$hiringCriteria.skills" }, count: { $sum: 1 } } }
])
```

---

**Q167. Companies with at least 1 OA round**

```javascript
db.companies.aggregate([
  { $match: { "interviewRounds.type": "OA" } },
  { $project: { name: 1 } }
])
```

---

**Q168. Max & Min base salary overall**

```javascript
db.companies.aggregate([
  { $group: { _id: null, maxBase: { $max: "$salaryBand.base" }, minBase: { $min: "$salaryBand.base" } } }
])
```

---

**Q169. Top 3 companies with most skills in hiringCriteria**

```javascript
db.companies.aggregate([
  { $project: { name: 1, skillCount: { $size: "$hiringCriteria.skills" } } },
  { $sort: { skillCount: -1 } },
  { $limit: 3 }
])
```

---

**Q170. List all unique interview round types**

```javascript
db.companies.aggregate([
  { $unwind: "$interviewRounds" },
  { $group: { _id: "$interviewRounds.type" } }
])
```

✅ \["OA","Technical","System Design","Managerial","HR","Culture Fit","Android Coding",…]

---

**Q171. Find companies where totalComp > average totalComp**

```javascript
db.companies.aggregate([
  { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  {
    $facet: {
      overall: [{ $group: { _id: null, avg: { $avg: "$totalComp" } } }],
      companies: [{ $project: { name: 1, totalComp: 1 } }]
    }
  }
])
```

👉 In practice, you’d compute average first, then compare in two-step pipeline.

---

**Q172. Show company names with benefit count**

```javascript
db.companies.aggregate([
  { $project: { name: 1, benefitCount: { $size: "$benefits" } } }
])
```

---

**Q173. Top 5 benefits by popularity**

```javascript
db.companies.aggregate([
  { $unwind: "$benefits" },
  { $group: { _id: "$benefits", count: { $sum: 1 } } },
  { $sort: { count: -1 } },
  { $limit: 5 }
])
```

---

**Q174. Count how many companies offer both WFH & Stock Options**

```javascript
db.companies.aggregate([
  { $match: { benefits: { $all: ["WFH", "Stock Options"] } } },
  { $count: "WFH_StockCompanies" }
])
```

---

**Q175. Highest-paying company per location**

```javascript
db.companies.aggregate([
  { $sort: { "salaryBand.base": -1 } },
  { $group: { _id: "$location", topCompany: { $first: "$name" }, topSalary: { $first: "$salaryBand.base" } } }
])
```

---

**Q176. Lowest CGPA requirement per location**

```javascript
db.companies.aggregate([
  { $sort: { "hiringCriteria.cgpa": 1 } },
  { $group: { _id: "$location", minCgpaCompany: { $first: "$name" }, minCgpa: { $first: "$hiringCriteria.cgpa" } } }
])
```

---

**Q177. Company-wise skill arrays as string**

```javascript
db.companies.aggregate([
  { $project: { name: 1, skills: { $reduce: { input: "$hiringCriteria.skills", initialValue: "", in: { $concat: ["$$value", " ", "$$this"] } } } } }
])
```

---

**Q178. Count companies grouped by experience requirement**

```javascript
db.companies.aggregate([
  { $group: { _id: "$hiringCriteria.experience", count: { $sum: 1 } } }
])
```

---

**Q179. Average number of rounds per company**

```javascript
db.companies.aggregate([
  { $project: { rounds: { $size: "$interviewRounds" } } },
  { $group: { _id: null, avgRounds: { $avg: "$rounds" } } }
])
```

---

**Q180. Top 3 companies by stock value**

```javascript
db.companies.aggregate([
  { $sort: { "salaryBand.stock": -1 } },
  { $limit: 3 }
])
```

✅ Meta, Apple, Coinbase.

---

**Q181. Top 3 companies by bonus**

```javascript
db.companies.aggregate([
  { $sort: { "salaryBand.bonus": -1 } },
  { $limit: 3 }
])
```

---

**Q182. Ratio of stock\:base for each company**

```javascript
db.companies.aggregate([
  { $project: { name: 1, ratio: { $divide: ["$salaryBand.stock", "$salaryBand.base"] } } }
])
```

---

**Q183. Show company names with base + bonus only**

```javascript
db.companies.aggregate([
  { $project: { name: 1, cashComp: { $add: ["$salaryBand.base", "$salaryBand.bonus"] } } }
])
```

---

**Q184. Bucket companies by number of skills**

```javascript
db.companies.aggregate([
  { $project: { name: 1, skillCount: { $size: "$hiringCriteria.skills" } } },
  { $bucket: { groupBy: "$skillCount", boundaries: [0, 2, 4, 10], default: "Other" } }
])
```

---

**Q185. Count companies that require DSA only**

```javascript
db.companies.aggregate([
  { $match: { "hiringCriteria.skills": "DSA" } },
  { $count: "DSACompanies" }
])
```

---

**Q186. Group: avg base by number of rounds**

```javascript
db.companies.aggregate([
  { $project: { rounds: { $size: "$interviewRounds" }, base: "$salaryBand.base" } },
  { $group: { _id: "$rounds", avgBase: { $avg: "$base" } } }
])
```

---

**Q187. Highest stock per skill**

```javascript
db.companies.aggregate([
  { $unwind: "$hiringCriteria.skills" },
  { $sort: { "salaryBand.stock": -1 } },
  { $group: { _id: "$hiringCriteria.skills", topCompany: { $first: "$name" }, topStock: { $first: "$salaryBand.stock" } } }
])
```

---

**Q188. Average salary difference (base-stock)**

```javascript
db.companies.aggregate([
  { $project: { name: 1, diff: { $subtract: ["$salaryBand.base", "$salaryBand.stock"] } } }
])
```

---

**Q189. Companies sorted by benefitCount then salary**

```javascript
db.companies.aggregate([
  { $project: { name: 1, benefitCount: { $size: "$benefits" }, base: "$salaryBand.base" } },
  { $sort: { benefitCount: -1, base: -1 } }
])
```

---

**Q190. Which company has max interview rounds**

```javascript
db.companies.aggregate([
  { $project: { name: 1, rounds: { $size: "$interviewRounds" } } },
  { $sort: { rounds: -1 } },
  { $limit: 1 }
])
```

---

**Q191. Count companies by location**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", count: { $sum: 1 } } }
])
```

---

**Q192. Average stock by location**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", avgStock: { $avg: "$salaryBand.stock" } } }
])
```

---

**Q193. Companies requiring both Java + System Design**

```javascript
db.companies.aggregate([
  { $match: { "hiringCriteria.skills": { $all: ["Java", "System Design"] } } }
])
```

---

**Q194. Group avg salary by experience level**

```javascript
db.companies.aggregate([
  { $group: { _id: "$hiringCriteria.experience", avgSalary: { $avg: "$salaryBand.base" } } }
])
```

---

**Q195. Top 3 companies with most employees**

```javascript
db.companies.aggregate([
  { $sort: { employeeCount: -1 } },
  { $limit: 3 }
])
```

✅ Infosys, TCS Digital, Amazon.

---

**Q196. Sum of employees across dataset**

```javascript
db.companies.aggregate([
  { $group: { _id: null, totalEmployees: { $sum: "$employeeCount" } } }
])
```

---

**Q197. Sort companies by cgpa then salary**

```javascript
db.companies.aggregate([
  { $sort: { "hiringCriteria.cgpa": -1, "salaryBand.base": -1 } }
])
```

---

**Q198. Location with max avgCompensation**

```javascript
db.companies.aggregate([
  { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $group: { _id: "$location", avgTotal: { $avg: "$totalComp" } } },
  { $sort: { avgTotal: -1 } },
  { $limit: 1 }
])
```

---

**Q199. Skill diversity: location with most distinct skills**

```javascript
db.companies.aggregate([
  { $unwind: "$hiringCriteria.skills" },
  { $group: { _id: { location: "$location", skill: "$hiringCriteria.skills" } } },
  { $group: { _id: "$_id.location", distinctSkills: { $sum: 1 } } },
  { $sort: { distinctSkills: -1 } }
])
```

---

**Q200. Final pipeline: dashboard summary**

```javascript
db.companies.aggregate([
  {
    $facet: {
      totalCompanies: [{ $count: "count" }],
      avgBase: [{ $group: { _id: null, avg: { $avg: "$salaryBand.base" } } }],
      topCompany: [
        { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
        { $sort: { totalComp: -1 } },
        { $limit: 1 },
        { $project: { name: 1, totalComp: 1 } }
      ]
    }
  }
])
```

✅ Returns a JSON object with stats.

---

# 📘 MongoDB Answer Book (Q201–Q240)

## Section D. Indexing & Performance

**Q201. Create index on `name`**

```javascript
db.companies.createIndex({ name: 1 })
```

✅ Allows faster search by company name.

---

**Q202. Compound index on `location + salaryBand.base`**

```javascript
db.companies.createIndex({ location: 1, "salaryBand.base": -1 })
```

✅ Optimizes queries filtering location and sorting salary.

---

**Q203. Create text index on `skills`**

```javascript
db.companies.createIndex({ "hiringCriteria.skills": "text" })
```

✅ Needed for full-text search on skills.

---

**Q204. Text search for "Java"**

```javascript
db.companies.find({ $text: { $search: "Java" } })
```

✅ Matches Google, Amazon, Salesforce, Uber, Flipkart, Infosys, Walmart Labs, Atlassian, Goldman Sachs.

---

**Q205. Index on `salaryBand.stock`**

```javascript
db.companies.createIndex({ "salaryBand.stock": 1 })
```

✅ Speeds up queries involving stock.

---

**Q206. Check index usage with explain()**

```javascript
db.companies.find({ name: "Amazon" }).explain("executionStats")
```

✅ Shows whether it used `name` index.

---

**Q207. Drop index on `name`**

```javascript
db.companies.dropIndex("name_1")
```

---

**Q208. Unique index on `name`**

```javascript
db.companies.createIndex({ name: 1 }, { unique: true })
```

✅ Prevents duplicate company names.

---

**Q209. Sparse index on `benefits`**

```javascript
db.companies.createIndex({ benefits: 1 }, { sparse: true })
```

✅ Only indexes docs where `benefits` exists.

---

**Q210. Partial index for base > 25**

```javascript
db.companies.createIndex(
  { "salaryBand.base": 1 },
  { partialFilterExpression: { "salaryBand.base": { $gt: 25 } } }
)
```

---

**Q211. Query with text search + sort by score**

```javascript
db.companies.find(
  { $text: { $search: "DSA" } },
  { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } })
```

---

**Q212. Collation for case-insensitive search**

```javascript
db.companies.find({ name: "amazon" }).collation({ locale: "en", strength: 2 })
```

---

**Q213. Compound index on `[location, employeeCount]`**

```javascript
db.companies.createIndex({ location: 1, employeeCount: -1 })
```

---

**Q214. Covered query example**

```javascript
db.companies.find({ name: "Google" }, { name: 1, _id: 0 }).explain("executionStats")
```

✅ Uses only `name` index → covered query.

---

**Q215. Multi-key index for `benefits`**

```javascript
db.companies.createIndex({ benefits: 1 })
```

✅ Allows queries like `db.companies.find({ benefits: "WFH" })`.

---

**Q216. Compare performance with vs without index**

```javascript
db.companies.find({ name: "Meta" }).explain("executionStats")
```

✅ With index → fewer scanned docs.

---

**Q217. Use hint() to force index**

```javascript
db.companies.find({ location: "Bangalore" }).hint({ location: 1, "salaryBand.base": -1 })
```

---

**Q218. Wildcard index for dynamic fields**

```javascript
db.companies.createIndex({ "$**": 1 })
```

✅ Indexes all fields (heavy, not recommended in prod).

---

**Q219. TTL index for `postedAt` (expire in 30 days)**

```javascript
db.companies.createIndex({ postedAt: 1 }, { expireAfterSeconds: 2592000 })
```

---

**Q220. Hashed index on `name` (sharding)**

```javascript
db.companies.createIndex({ name: "hashed" })
```

---

**Q221. Background index creation**

```javascript
db.companies.createIndex({ "salaryBand.base": 1 }, { background: true })
```

---

**Q222. Drop all indexes**

```javascript
db.companies.dropIndexes()
```

---

**Q223. Recreate index on CGPA**

```javascript
db.companies.createIndex({ "hiringCriteria.cgpa": 1 })
```

---

**Q224. Unique + partial index (Bangalore companies only)**

```javascript
db.companies.createIndex(
  { name: 1 },
  { unique: true, partialFilterExpression: { location: "Bangalore" } }
)
```

---

**Q225. Explain plan for range query**

```javascript
db.companies.find({ "salaryBand.base": { $gte: 25, $lte: 35 } }).explain("executionStats")
```

✅ Shows whether index is used.

---

**Q226. Create text + compound index**

```javascript
db.companies.createIndex({ "hiringCriteria.skills": "text", location: 1 })
```

---

**Q227. Covered query for base+stock**

```javascript
db.companies.createIndex({ "salaryBand.base": 1, "salaryBand.stock": 1 })
db.companies.find(
  { "salaryBand.base": { $gt: 20 } },
  { "salaryBand.base": 1, "salaryBand.stock": 1, _id: 0 }
).explain("executionStats")
```

---

**Q228. Query sorted by compound index fields**

```javascript
db.companies.find().sort({ location: 1, employeeCount: -1 })
```

---

**Q229. Explain stats for regex query**

```javascript
db.companies.find({ name: { $regex: /^A/ } }).explain("executionStats")
```

⚠️ Regex may not use index efficiently unless it’s prefix-based.

---

**Q230. Paginate using index on base salary**

```javascript
db.companies.find({}).sort({ "salaryBand.base": 1 }).limit(5)
```

---

**Q231. Paginate using skip-limit**

```javascript
db.companies.find().sort({ "salaryBand.base": 1 }).skip(5).limit(5)
```

---

**Q232. Compare skip-limit vs range queries (efficient)**

```javascript
db.companies.find({ "salaryBand.base": { $gt: 25 } }).limit(5)
```

✅ Range query more efficient than skip.

---

**Q233. Test query with array index**

```javascript
db.companies.find({ benefits: "Health Insurance" }).explain("executionStats")
```

---

**Q234. Index nested field `hiringCriteria.cgpa`**

```javascript
db.companies.createIndex({ "hiringCriteria.cgpa": 1 })
```

---

**Q235. Drop index on `benefits`**

```javascript
db.companies.dropIndex("benefits_1")
```

---

**Q236. Rebuild all indexes**

```javascript
db.companies.reIndex()
```

---

**Q237. Analyze query cache**

```javascript
db.serverStatus().wiredTiger.cache
```

✅ Shows cache usage stats.

---

**Q238. Use hint() with wrong index**

```javascript
db.companies.find({ "salaryBand.base": { $gt: 25 } }).hint({ location: 1 })
```

⚠️ Forces inefficient index usage.

---

**Q239. Index with collation (case-insensitive)**

```javascript
db.companies.createIndex({ name: 1 }, { collation: { locale: "en", strength: 2 } })
```

---

**Q240. Multi-field partial index**

```javascript
db.companies.createIndex(
  { location: 1, "salaryBand.base": 1 },
  { partialFilterExpression: { "salaryBand.base": { $gt: 25 } } }
)
```

---

Excellent — let’s wrap this up with the **Bonus & Challenge Section (Q241–Q280)**.
This section mixes **complex queries, analytics, and dashboard-style aggregations**.
We’ll continue with the same `companies` dataset (20 companies).

---

# 📘 MongoDB Answer Book (Q241–Q280)

---

## Section E. Bonus Challenges

---

**Q241. Top 5 highest-paying companies with WFH**

```javascript
db.companies.aggregate([
  { $match: { benefits: "WFH" } },
  { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $sort: { totalComp: -1 } },
  { $limit: 5 }
])
```

✅ Expected: Stripe, Netflix, Coinbase, Google, Flipkart.

---

**Q242. Avg salary > 30 LPA grouped by location**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", avgBase: { $avg: "$salaryBand.base" } } },
  { $match: { avgBase: { $gt: 30 } } }
])
```

✅ Likely: Hyderabad, Bangalore.

---

**Q243. Companies requiring DSA, sorted by totalComp**

```javascript
db.companies.aggregate([
  { $match: { "hiringCriteria.skills": "DSA" } },
  { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $sort: { totalComp: -1 } }
])
```

---

**Q244. Companies where base > avg(base)**

```javascript
let avgBase = db.companies.aggregate([{ $group: { _id: null, avgBase: { $avg: "$salaryBand.base" } } }]).toArray()[0].avgBase;
db.companies.find({ "salaryBand.base": { $gt: avgBase } })
```

---

**Q245. Bucket companies by CGPA requirement**

```javascript
db.companies.aggregate([
  { $bucket: {
      groupBy: "$hiringCriteria.cgpa",
      boundaries: [0, 6.5, 7.5, 8.5, 10],
      default: "Other",
      output: { count: { $sum: 1 } }
  } }
])
```

---

**Q246. Most common skill required**

```javascript
db.companies.aggregate([
  { $unwind: "$hiringCriteria.skills" },
  { $group: { _id: "$hiringCriteria.skills", count: { $sum: 1 } } },
  { $sort: { count: -1 } },
  { $limit: 1 }
])
```

✅ Most likely: "DSA".

---

**Q247. Most common benefit offered**

```javascript
db.companies.aggregate([
  { $unwind: "$benefits" },
  { $group: { _id: "$benefits", count: { $sum: 1 } } },
  { $sort: { count: -1 } },
  { $limit: 1 }
])
```

✅ Most likely: "Health Insurance".

---

**Q248. Rank companies by salary in each location**

```javascript
db.companies.aggregate([
  { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $sort: { location: 1, totalComp: -1 } },
  { $group: {
      _id: "$location",
      companies: { $push: { name: "$name", totalComp: "$totalComp" } }
  } }
])
```

---

**Q249. Dashboard pipeline: avg salary + top company per location**

```javascript
db.companies.aggregate([
  { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $sort: { totalComp: -1 } },
  { $group: {
      _id: "$location",
      avgSalary: { $avg: "$salaryBand.base" },
      topCompany: { $first: "$name" }
  } }
])
```

---

**Q250. Avg interview rounds per company**

```javascript
db.companies.aggregate([
  { $project: { name: 1, rounds: { $size: "$interviewRounds" } } },
  { $group: { _id: null, avgRounds: { $avg: "$rounds" } } }
])
```

---

**Q251. Companies offering both Stock Options + Relocation**

```javascript
db.companies.find({ benefits: { $all: ["Stock Options", "Relocation"] } })
```

✅ Likely: Google, Goldman Sachs.

---

**Q252. Total employees across Bangalore companies**

```javascript
db.companies.aggregate([
  { $match: { location: "Bangalore" } },
  { $group: { _id: null, total: { $sum: "$employeeCount" } } }
])
```

---

**Q253. Company with highest stock value**

```javascript
db.companies.find().sort({ "salaryBand.stock": -1 }).limit(1)
```

✅ Meta (20).

---

**Q254. Company with lowest bonus**

```javascript
db.companies.find().sort({ "salaryBand.bonus": 1 }).limit(1)
```

✅ Infosys, TCS Digital, Zomato (bonus = 1–2).

---

**Q255. All unique skills across companies**

```javascript
db.companies.distinct("hiringCriteria.skills")
```

✅ \["DSA","System Design","Java","C++","Python","OS","Cloud","Microservices","Finance","DBMS",…]

---

**Q256. Count unique interview types**

```javascript
db.companies.aggregate([
  { $unwind: "$interviewRounds" },
  { $group: { _id: "$interviewRounds.type" } },
  { $count: "uniqueInterviewTypes" }
])
```

---

**Q257. Leaderboard by employee count**

```javascript
db.companies.find({}, { name: 1, employeeCount: 1 }).sort({ employeeCount: -1 })
```

✅ Infosys, TCS Digital, Amazon.

---

**Q258. Companies offering Device Discounts**

```javascript
db.companies.find({ benefits: "Device Discounts" })
```

✅ Apple.

---

**Q259. Companies where benefits > skills count**

```javascript
db.companies.aggregate([
  { $project: {
      name: 1,
      skillCount: { $size: "$hiringCriteria.skills" },
      benefitCount: { $size: "$benefits" }
  } },
  { $match: { $expr: { $gt: ["$benefitCount", "$skillCount"] } } }
])
```

---

**Q260. Nested lookup: Companies ↔ Candidates**

```javascript
db.companies.aggregate([
  { $lookup: { from: "candidates", localField: "name", foreignField: "company", as: "applicants" } },
  { $unwind: "$applicants" },
  { $lookup: { from: "interviews", localField: "applicants._id", foreignField: "candidateId", as: "interviewDetails" } }
])
```

---

**Q261. Avg stock grouped by location**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", avgStock: { $avg: "$salaryBand.stock" } } }
])
```

---

**Q262. Companies with salary > 1.5× avg salary**

```javascript
let avgSalary = db.companies.aggregate([{ $group: { _id: null, avg: { $avg: "$salaryBand.base" } } }]).toArray()[0].avg;
db.companies.find({ "salaryBand.base": { $gt: avgSalary * 1.5 } })
```

---

**Q263. Locations with more than 3 companies**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", count: { $sum: 1 } } },
  { $match: { count: { $gt: 3 } } }
])
```

✅ Likely: Bangalore, Hyderabad.

---

**Q264. Bangalore + WFH + base > 25**

```javascript
db.companies.find({ location: "Bangalore", benefits: "WFH", "salaryBand.base": { $gt: 25 } })
```

✅ Matches: Google, Flipkart.

---

**Q265. Companies NOT requiring CGPA ≥ 7.5**

```javascript
db.companies.find({ "hiringCriteria.cgpa": { $lt: 7.5 } })
```

---

**Q266. Top 3 companies by interview round count**

```javascript
db.companies.aggregate([
  { $project: { name: 1, roundCount: { $size: "$interviewRounds" } } },
  { $sort: { roundCount: -1 } },
  { $limit: 3 }
])
```

✅ Google, Amazon, Microsoft (4+ rounds).

---

**Q267. Salary distribution in 5 bands**

```javascript
db.companies.aggregate([
  { $bucketAuto: { groupBy: "$salaryBand.base", buckets: 5 } }
])
```

---

**Q268. Text search API-style query**

```javascript
db.companies.find(
  { $text: { $search: "System Design" } },
  { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } })
```

---

**Q269. Companies grouped by experience requirement**

```javascript
db.companies.aggregate([
  { $group: { _id: "$hiringCriteria.experience", count: { $sum: 1 } } }
])
```

---

**Q270. Companies offering both Free Meals & Free Lunch**

```javascript
db.companies.find({ benefits: { $all: ["Free Meals", "Free Lunch"] } })
```

✅ Matches: None (since only Swiggy has Free Meals, Paytm has Free Lunch).

---

**Q271. Location with highest avg stock**

```javascript
db.companies.aggregate([
  { $group: { _id: "$location", avgStock: { $avg: "$salaryBand.stock" } } },
  { $sort: { avgStock: -1 } },
  { $limit: 1 }
])
```

---

**Q272. Rank skills by frequency**

```javascript
db.companies.aggregate([
  { $unwind: "$hiringCriteria.skills" },
  { $group: { _id: "$hiringCriteria.skills", freq: { $sum: 1 } } },
  { $sort: { freq: -1 } }
])
```

---

**Q273. Companies with stock+base > 40**

```javascript
db.companies.aggregate([
  { $addFields: { sum: { $add: ["$salaryBand.base", "$salaryBand.stock"] } } },
  { $match: { sum: { $gt: 40 } } }
])
```

✅ Matches: Meta, Stripe, Coinbase.

---

**Q274. Companies requiring Java but not System Design**

```javascript
db.companies.find({
  "hiringCriteria.skills": "Java",
  "hiringCriteria.skills": { $ne: "System Design" }
})
```

---

**Q275. Companies with "Culture Fit" round**

```javascript
db.companies.find({ "interviewRounds.type": "Culture Fit" })
```

✅ Meta.

---

**Q276. Companies where base > stock+bonus**

```javascript
db.companies.find({ $expr: { $gt: ["$salaryBand.base", { $add: ["$salaryBand.stock", "$salaryBand.bonus"] }] } })
```

---

**Q277. Company with maximum total compensation**

```javascript
db.companies.aggregate([
  { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
  { $sort: { totalComp: -1 } },
  { $limit: 1 }
])
```

✅ Stripe.

---

**Q278. Salary percentiles (approx)**

```javascript
db.companies.aggregate([
  { $bucketAuto: { groupBy: "$salaryBand.base", buckets: 4 } }
])
```

✅ Splits into quartiles.

---

**Q279. Group by benefit count**

```javascript
db.companies.aggregate([
  { $project: { name: 1, benefitCount: { $size: "$benefits" } } },
  { $group: { _id: "$benefitCount", companies: { $push: "$name" } } }
])
```

---

**Q280. Final dashboard output**

```javascript
db.companies.aggregate([
  {
    $facet: {
      totalCompanies: [{ $count: "count" }],
      avgBase: [{ $group: { _id: null, avg: { $avg: "$salaryBand.base" } } }],
      mostCommonSkill: [
        { $unwind: "$hiringCriteria.skills" },
        { $group: { _id: "$hiringCriteria.skills", count: { $sum: 1 } } },
        { $sort: { count: -1 } },
        { $limit: 1 }
      ],
      mostCommonBenefit: [
        { $unwind: "$benefits" },
        { $group: { _id: "$benefits", count: { $sum: 1 } } },
        { $sort: { count: -1 } },
        { $limit: 1 }
      ],
      highestPayingCompany: [
        { $addFields: { totalComp: { $add: ["$salaryBand.base", "$salaryBand.bonus", "$salaryBand.stock"] } } },
        { $sort: { totalComp: -1 } },
        { $limit: 1 },
        { $project: { name: 1, totalComp: 1 } }
      ]
    }
  }
])
```

✅ Returns:

* `totalCompanies` \~20
* `avgBase` \~25–28
* `mostCommonSkill` → "DSA"
* `mostCommonBenefit` → "Health Insurance"
* `highestPayingCompany` → Stripe

---

