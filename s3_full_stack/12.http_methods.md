# **12.HTTP Methods (GET, POST, PUT, DELETE) in Next.js APIs**

When building APIs in Next.js, one of the most important concepts to understand is **how different HTTP methods map to CRUD operations**.

* **CRUD** stands for **Create, Read, Update, Delete** — the basic operations we perform on data.
* HTTP methods like **GET, POST, PUT, PATCH, and DELETE** directly represent these operations.

In this article, we’ll not only see **full code files** (so you can run them directly) but also break down **how requests flow**, **how responses are sent**, and **why each method is used**. We’ll cover both **Pages Router** and **App Router** approaches.

---

## **1. Why Do We Need Different HTTP Methods?**

Imagine we are managing a **students database** in CodingGita.
We might want to:

* Fetch the list of all students → **GET**
* Add a new student → **POST**
* Update details of an existing student → **PUT** or **PATCH**
* Delete a student record → **DELETE**

If we only had GET, our API would be confusing because the same request could mean different things.
That’s why HTTP methods exist — they **separate the intent of each action clearly**.

---

## **2. GET Method – Reading Data**

The **GET** method fetches data. It never modifies anything — it’s read-only.

### Pages Router: `pages/api/students.js`

```javascript
// pages/api/students.js

export default function handler(req, res) {
  if (req.method === "GET") {
    const students = [
      { id: 1, name: "Jenil" },
      { id: 2, name: "Priyesha" },
    ];

    res.status(200).json(students);
  } else {
    res.status(405).json({ message: "Method Not Allowed" });
  }
}
```

**Explanation:**

* `req.method` checks if the request is GET.
* If yes, we return a list of students.
* `res.status(200)` means success, and `.json(students)` sends the response.
* Any other method (like POST) returns **405 Method Not Allowed**.

Open [http://localhost:3000/api/students](http://localhost:3000/api/students) and you’ll see the students in JSON.

---

### App Router: `app/api/students/route.js`

```javascript
// app/api/students/route.js
import { NextResponse } from "next/server";

export async function GET() {
  const students = [
    { id: 1, name: "Jenil" },
    { id: 2, name: "Priyesha" },
  ];

  return NextResponse.json(students, { status: 200 });
}
```

**Explanation:**
Here we don’t check `req.method`. Instead, App Router lets us directly **export GET**.
When a GET request hits `/api/students`, this function runs.

---

## **3. POST Method – Creating Data**

The **POST** method is used to **add new data**.
The client sends a **request body** with the details.

### Pages Router: `pages/api/students.js`

```javascript
// pages/api/students.js

let students = [
  { id: 1, name: "Jenil" },
  { id: 2, name: "Priyesha" },
];

export default function handler(req, res) {
  if (req.method === "POST") {
    const newStudent = { id: Date.now(), ...req.body };
    students.push(newStudent);

    res.status(201).json(newStudent);
  } else {
    res.status(405).json({ message: "Method Not Allowed" });
  }
}
```

**Explanation:**

* `req.body` contains the data sent from the client (e.g., `{ "name": "Krishna" }`).
* We give it a unique ID using `Date.now()`.
* Push into `students` and return it with `201 Created`.

You can test with:

```js
await fetch("/api/students", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ name: "Krishna" }),
});
```

---

### App Router: `app/api/students/route.js`

```javascript
// app/api/students/route.js
import { NextResponse } from "next/server";

let students = [
  { id: 1, name: "Jenil" },
  { id: 2, name: "Priyesha" },
];

export async function POST(request) {
  const body = await request.json();
  const newStudent = { id: Date.now(), ...body };
  students.push(newStudent);

  return NextResponse.json(newStudent, { status: 201 });
}
```

**Explanation:**

* `await request.json()` parses the incoming body.
* We create and return the new student.

---

## **4. PUT vs PATCH – Updating Data**

* **PUT** replaces the entire resource. If you forget a field, it may be lost.
* **PATCH** only updates the fields you send.

### App Router: `app/api/students/[id]/route.js`

```javascript
// app/api/students/[id]/route.js
import { NextResponse } from "next/server";

let students = [
  { id: 1, name: "Jenil", age: 22 },
  { id: 2, name: "Priyesha", age: 21 },
];

export async function PUT(request, { params }) {
  const body = await request.json();
  let student = students.find((s) => s.id === parseInt(params.id));

  if (!student) {
    return NextResponse.json({ message: "Student not found" }, { status: 404 });
  }

  // PUT replaces fields
  student = { ...student, ...body };

  return NextResponse.json(student);
}

export async function PATCH(request, { params }) {
  const body = await request.json();
  let student = students.find((s) => s.id === parseInt(params.id));

  if (!student) {
    return NextResponse.json({ message: "Student not found" }, { status: 404 });
  }

  // PATCH updates only provided fields
  Object.assign(student, body);

  return NextResponse.json(student);
}
```

**Example difference:**

```json
// Current student
{ "id": 1, "name": "Jenil", "age": 22 }

// PUT body
{ "id": 1, "name": "Krishna" }
// → Could overwrite and remove "age"

// PATCH body
{ "name": "Krishna" }
// → Only changes name, keeps "age": 22
```

---

## **5. DELETE Method – Removing Data**

The **DELETE** method removes a record.

### Pages Router: `pages/api/students/[id].js`

```javascript
// pages/api/students/[id].js

let students = [
  { id: 1, name: "Jenil" },
  { id: 2, name: "Priyesha" },
];

export default function handler(req, res) {
  const { id } = req.query;

  if (req.method === "DELETE") {
    students = students.filter((s) => s.id !== parseInt(id));
    res.status(200).json({ message: "Student deleted" });
  } else {
    res.status(405).json({ message: "Method Not Allowed" });
  }
}
```

---

### App Router: `app/api/students/[id]/route.js`

```javascript
// app/api/students/[id]/route.js
import { NextResponse } from "next/server";

let students = [
  { id: 1, name: "Jenil" },
  { id: 2, name: "Priyesha" },
];

export async function DELETE(request, { params }) {
  students = students.filter((s) => s.id !== parseInt(params.id));
  return NextResponse.json({ message: "Student deleted" });
}
```

---

## **6. Handling Unsupported Methods**

If someone sends a method you don’t support, return **405 Method Not Allowed**.

* Pages Router:

  ```js
  res.status(405).json({ message: "Method Not Allowed" });
  ```

* App Router:

  ```js
  return NextResponse.json({ message: "Method Not Allowed" }, { status: 405 });
  ```

---

## **7. Summary Table**

| CRUD Operation | Pages Router (`pages/api/...`)             | App Router (`app/api/.../route.js`)    |
| -------------- | ------------------------------------------ | -------------------------------------- |
| **GET**        | `if (req.method === "GET")` → `res.json()` | `export async function GET()`          |
| **POST**       | `if (req.method === "POST")` → `req.body`  | `export async function POST(request)`  |
| **PUT**        | `if (req.method === "PUT")`                | `export async function PUT(request)`   |
| **PATCH**      | `if (req.method === "PATCH")`              | `export async function PATCH(request)` |
| **DELETE**     | `if (req.method === "DELETE")`             | `export async function DELETE()`       |

---

## **Key Takeaways**

* **GET** → fetch data (safe, read-only).
* **POST** → create records (use 201 Created).
* **PUT** → replace/update whole record.
* **PATCH** → update part of a record.
* **DELETE** → remove records.
* **Pages Router**: uses `req.method` inside one handler.
* **App Router**: exports separate functions for each method (cleaner).
* Always return **405 Method Not Allowed** for unsupported methods.

---
