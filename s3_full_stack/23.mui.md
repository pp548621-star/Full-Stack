# 23.1 Theming in Next.js with MUI (`ThemeProvider` setup + SSR-safe styles)

## What we’ll build

* Install MUI for Next.js (App Router).
* Create a **custom Material theme** (colors, typography, shape, components).
* Add a **ThemeRegistry** to make Emotion styles work with Next.js SSR.
* Wrap the app with the theme via `ThemeProvider`.

## 1) Install packages

```bash
# In an existing Next.js (App Router) project:
npm i @mui/material @mui/icons-material @emotion/react @emotion/styled
```

## 2) Create a theme

`src/theme.ts`

```ts
// src/theme.ts
import { createTheme, PaletteMode } from "@mui/material";

export const getDesignTokens = (mode: PaletteMode) =>
  ({
    palette: {
      mode,
      primary: { main: "#1a73e8" },      // Google Material blue-ish
      secondary: { main: "#ff6d00" },
      background: {
        default: mode === "light" ? "#fafafa" : "#0b0f19",
        paper: mode === "light" ? "#ffffff" : "#0f1524",
      },
    },
    shape: { borderRadius: 14 },
    typography: {
      fontFamily:
        'Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"',
      h1: { fontWeight: 700, fontSize: "2rem" },
      h2: { fontWeight: 700, fontSize: "1.5rem" },
      h3: { fontWeight: 600, fontSize: "1.25rem" },
      body1: { lineHeight: 1.6 },
    },
    components: {
      MuiButton: {
        defaultProps: { disableElevation: true },
        styleOverrides: {
          root: { borderRadius: 12, textTransform: "none", fontWeight: 600 },
        },
      },
      MuiCard: {
        styleOverrides: {
          root: { borderRadius: 16 },
        },
      },
      MuiContainer: {
        defaultProps: { maxWidth: "lg" },
      },
    },
  } as const);

export function makeTheme(mode: PaletteMode) {
  return createTheme(getDesignTokens(mode));
}
```

## 3) SSR style injection for MUI (Emotion) — ThemeRegistry

`src/components/ThemeRegistry.tsx`

```tsx
"use client";

import * as React from "react";
import { ThemeProvider, CssBaseline } from "@mui/material";
import { useServerInsertedHTML } from "next/navigation";
import createCache from "@emotion/cache";
import { CacheProvider } from "@emotion/react";
import { makeTheme } from "@/theme";

function createEmotionCache() {
  return createCache({ key: "mui", prepend: true });
}

export default function ThemeRegistry({
  children,
  mode = "light",
}: {
  children: React.ReactNode;
  mode?: "light" | "dark";
}) {
  const [{ cache, flush }] = React.useState(() => {
    const cache = createEmotionCache();
    cache.compat = true;
    const prevInsert = cache.insert;
    let inserted: string[] = [];
    cache.insert = (...args: any[]) => {
      const serialized = args[1];
      if (cache.inserted[serialized.name] === undefined) {
        inserted.push(serialized.name);
      }
      // @ts-ignore
      return prevInsert(...args);
    };
    const flush = () => {
      const prev = inserted;
      inserted = [];
      return prev;
    };
    return { cache, flush };
  });

  useServerInsertedHTML(() => (
    <style
      data-emotion={`mui ${flush().join(" ")}`}
      dangerouslySetInnerHTML={{ __html: Object.values(cache.inserted).join(" ") }}
    />
  ));

  const theme = React.useMemo(() => makeTheme(mode), [mode]);

  return (
    <CacheProvider value={cache}>
      <ThemeProvider theme={theme}>
        <CssBaseline />
        {children}
      </ThemeProvider>
    </CacheProvider>
  );
}
```

## 4) Use ThemeRegistry in your root layout

`src/app/layout.tsx`

```tsx
import type { Metadata } from "next";
import ThemeRegistry from "@/components/ThemeRegistry";

export const metadata: Metadata = {
  title: "MUI + Next.js Starter",
  description: "Material UI theming in Next.js (App Router)",
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        {/* default to light; we’ll add dark toggle later */}
        <ThemeRegistry mode="light">{children}</ThemeRegistry>
      </body>
    </html>
  );
}
```

You’ve got a solid, SSR-friendly theme base. Next we’ll layout responsive UI.

---

# 23.2 — Responsive Layouts with `Container`, `Grid`, `Box`, `Card`

## Goals

* Build a **hero** section + **responsive card grid**.
* Mobile-first spacing and typography.
* Showcase `Grid` breakpoints and reusable layout primitives.

`src/app/page.tsx`

```tsx
"use client";

import * as React from "react";
import {
  Container,
  Box,
  Typography,
  Grid,
  Card,
  CardContent,
  CardMedia,
  CardActionArea,
  Chip,
  Button,
  Stack,
} from "@mui/material";

const items = [
  {
    title: "Next.js + APIs",
    body: "Learn server routes, caching, and data fetching patterns.",
    href: "http://codinggita.com/",
    img: "https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=1200&auto=format&fit=crop",
    chip: "Backend",
  },
  {
    title: "MongoDB + Mongoose",
    body: "Persist your app state with models and relations.",
    href: "http://codinggita.com/",
    img: "https://images.unsplash.com/photo-1558494949-ef010cbdcc31?q=80&w=1200&auto=format&fit=crop",
    chip: "Database",
  },
  {
    title: "UI with MUI",
    body: "Material-compliant components with responsive design.",
    href: "http://codinggita.com/",
    img: "https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=1200&auto=format&fit=crop",
    chip: "Frontend",
  },
];

export default function HomePage() {
  return (
    <Container sx={{ py: { xs: 4, md: 8 } }}>
      {/* Hero */}
      <Box
        sx={{
          display: "grid",
          gap: 2,
          gridTemplateColumns: { xs: "1fr", md: "1.1fr 0.9fr" },
          alignItems: "center",
          mb: { xs: 4, md: 8 },
        }}
      >
        <Box>
          <Chip label="Material UI + Next.js" sx={{ mb: 2, fontWeight: 600 }} />
          <Typography variant="h1" sx={{ fontSize: { xs: 28, md: 40 }, mb: 1 }}>
            Build delightful, responsive UIs faster
          </Typography>
          <Typography sx={{ color: "text.secondary", mb: 3 }}>
            Use Container, Grid, Box, and Card to create clean, mobile-first layouts. Extend with a custom theme to match your brand.
          </Typography>
          <Stack direction="row" spacing={1.5}>
            <Button variant="contained" size="large" href="http://codinggita.com/">
              Explore Guides
            </Button>
            <Button variant="outlined" size="large" href="http://codinggita.com/">
              Docs
            </Button>
          </Stack>
        </Box>

        <Box
          sx={{
            height: { xs: 200, md: 320 },
            borderRadius: 3,
            overflow: "hidden",
            bgcolor: "background.paper",
            boxShadow: 3,
            backgroundImage:
              "url(https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=1400&auto=format&fit=crop)",
            backgroundSize: "cover",
            backgroundPosition: "center",
          }}
        />
      </Box>

      {/* Card grid */}
      <Grid container spacing={3}>
        {items.map((card) => (
          <Grid key={card.title} item xs={12} sm={6} md={4}>
            <Card
              sx={{
                height: "100%",
                display: "flex",
                flexDirection: "column",
                boxShadow: { xs: 2, md: 4 },
              }}
            >
              <CardActionArea href={card.href} sx={{ flexGrow: 1 }}>
                <CardMedia component="img" height="160" image={card.img} alt={card.title} />
                <CardContent>
                  <Chip
                    size="small"
                    label={card.chip}
                    sx={{ mb: 1, fontWeight: 600 }}
                    color="primary"
                    variant="outlined"
                  />
                  <Typography variant="h3" sx={{ fontSize: 18, mb: 0.5 }}>
                    {card.title}
                  </Typography>
                  <Typography sx={{ color: "text.secondary" }}>{card.body}</Typography>
                </CardContent>
              </CardActionArea>
              <Box sx={{ p: 2, pt: 0 }}>
                <Button href={card.href} endIcon={<span aria-hidden>→</span>} size="small">
                  Read more
                </Button>
              </Box>
            </Card>
          </Grid>
        ))}
      </Grid>
    </Container>
  );
}
```

Key responsive ideas:

* `Container` provides consistent horizontal padding.
* `Grid` uses `xs / sm / md` breakpoints to adapt columns.
* `Box` is the utility primitive for spacing, radii, and layout.
* `Card` patterns feel native to Material Design.

---

# 23.3 — Custom Components & Reusable UI Patterns

We’ll build small, composable pieces you’ll reuse across pages: `AppShell`, `InfoCard`, and a `Section` wrapper.

## 1) AppShell (AppBar + containerized content)

`src/components/AppShell.tsx`

```tsx
"use client";

import * as React from "react";
import {
  AppBar,
  Toolbar,
  Typography,
  Container,
  Box,
  IconButton,
  Stack,
  Button,
} from "@mui/material";
import Link from "next/link";

export default function AppShell({ children, right }: { children: React.ReactNode; right?: React.ReactNode }) {
  return (
    <Box>
      <AppBar position="sticky" color="transparent" elevation={0}
        sx={{ backdropFilter: "blur(8px)", borderBottom: "1px solid", borderColor: "divider" }}>
        <Toolbar>
          <Typography variant="h6" sx={{ fontWeight: 800, letterSpacing: 0.2, flexGrow: 1 }}>
            CodingGita UI
          </Typography>
          <Stack direction="row" spacing={1} alignItems="center">
            <Button component={Link} href="http://codinggita.com/" variant="text">Home</Button>
            <Button component={Link} href="http://codinggita.com/" variant="text">Courses</Button>
            {right}
          </Stack>
        </Toolbar>
      </AppBar>

      <Container sx={{ py: { xs: 3, md: 6 } }}>{children}</Container>
    </Box>
  );
}
```

## 2) Section wrapper for consistent spacing

`src/components/Section.tsx`

```tsx
"use client";
import { Box, Typography } from "@mui/material";

export default function Section({
  title,
  subtitle,
  children,
}: {
  title: string;
  subtitle?: string;
  children: React.ReactNode;
}) {
  return (
    <Box sx={{ mb: { xs: 4, md: 8 } }}>
      <Typography variant="h2" sx={{ fontSize: { xs: 22, md: 28 }, mb: 0.5 }}>
        {title}
      </Typography>
      {subtitle && (
        <Typography sx={{ color: "text.secondary", mb: 2 }}>{subtitle}</Typography>
      )}
      {children}
    </Box>
  );
}
```

## 3) InfoCard (reusable, slot-based)

`src/components/InfoCard.tsx`

```tsx
"use client";
import { Card, CardContent, CardActionArea, Typography, Box } from "@mui/material";

export default function InfoCard({
  title,
  description,
  href,
  media,
  footer,
}: {
  title: string;
  description?: string;
  href?: string;
  media?: React.ReactNode;
  footer?: React.ReactNode;
}) {
  const body = (
    <Card sx={{ height: "100%", display: "flex", flexDirection: "column" }}>
      {media && <Box sx={{ "& img": { display: "block", width: "100%", height: 160, objectFit: "cover" } }}>{media}</Box>}
      <CardContent sx={{ flexGrow: 1 }}>
        <Typography variant="h3" sx={{ fontSize: 18, mb: 0.5 }}>
          {title}
        </Typography>
        {description && <Typography sx={{ color: "text.secondary" }}>{description}</Typography>}
      </CardContent>
      {footer && <Box sx={{ px: 2, pb: 2 }}>{footer}</Box>}
    </Card>
  );

  return href ? <CardActionArea href={href}>{body}</CardActionArea> : body;
}
```

## 4) Using them together

Replace `src/app/page.tsx` with an AppShell + Sections composition (optional), or compose in a new route:

```tsx
"use client";

import * as React from "react";
import { Grid, Button } from "@mui/material";
import AppShell from "@/components/AppShell";
import Section from "@/components/Section";
import InfoCard from "@/components/InfoCard";

export default function PatternsPage() {
  return (
    <AppShell>
      <Section title="Reusable Patterns" subtitle="Compose clean, consistent sections and cards.">
        <Grid container spacing={3}>
          {[1, 2, 3].map((i) => (
            <Grid key={i} item xs={12} sm={6} md={4}>
              <InfoCard
                title={`Pattern #${i}`}
                description="Built once, reused everywhere."
                href="http://codinggita.com/"
                media={<img alt="" src="https://images.unsplash.com/photo-1558494949-ef010cbdcc31?q=80&w=1200&auto=format&fit=crop" />}
                footer={<Button size="small">Open</Button>}
              />
            </Grid>
          ))}
        </Grid>
      </Section>
    </AppShell>
  );
}
```

---

# 23.4 — Light/Dark Mode Switch (persistent, Next.js App Router)

We’ll add a **ColorModeContext** and a client component to toggle the theme. We’ll persist the choice in `localStorage` (simple and effective). You can later advance to cookies for SSR-perfect initial mode.

## 1) Color mode provider

`src/components/ColorMode.tsx`

```tsx
"use client";

import * as React from "react";
import { PaletteMode } from "@mui/material";
import ThemeRegistry from "@/components/ThemeRegistry";

type Ctx = { mode: PaletteMode; toggle: () => void; set: (m: PaletteMode) => void };
export const ColorModeContext = React.createContext<Ctx>({
  mode: "light",
  toggle: () => {},
  set: () => {},
});

export default function ColorModeProvider({ children }: { children: React.ReactNode }) {
  const [mode, setMode] = React.useState<PaletteMode>("light");
  const [mounted, setMounted] = React.useState(false);

  React.useEffect(() => {
    const saved = (typeof window !== "undefined" && localStorage.getItem("mui-mode")) as PaletteMode | null;
    if (saved) setMode(saved);
    else {
      const prefersDark = window.matchMedia?.("(prefers-color-scheme: dark)").matches;
      setMode(prefersDark ? "dark" : "light");
    }
    setMounted(true);
  }, []);

  React.useEffect(() => {
    if (mounted) localStorage.setItem("mui-mode", mode);
  }, [mode, mounted]);

  const ctx: Ctx = {
    mode,
    toggle: () => setMode((m) => (m === "light" ? "dark" : "light")),
    set: setMode,
  };

  // Avoid hydration mismatch by rendering after mount
  if (!mounted) return null;

  return (
    <ColorModeContext.Provider value={ctx}>
      <ThemeRegistry mode={mode}>{children}</ThemeRegistry>
    </ColorModeContext.Provider>
  );
}
```

## 2) Toggle button to place in the AppBar

`src/components/ColorModeToggle.tsx`

```tsx
"use client";

import * as React from "react";
import { IconButton, Tooltip } from "@mui/material";
import { DarkMode, LightMode } from "@mui/icons-material";
import { ColorModeContext } from "./ColorMode";

export default function ColorModeToggle() {
  const { mode, toggle } = React.useContext(ColorModeContext);
  return (
    <Tooltip title={mode === "light" ? "Switch to dark" : "Switch to light"}>
      <IconButton onClick={toggle} size="small" aria-label="toggle color mode">
        {mode === "light" ? <DarkMode fontSize="small" /> : <LightMode fontSize="small" />}
      </IconButton>
    </Tooltip>
  );
}
```

## 3) Use the provider in root layout and show toggle in AppShell

Update `src/app/layout.tsx` to use the color mode provider instead of ThemeRegistry directly:

```tsx
import type { Metadata } from "next";
import ColorModeProvider from "@/components/ColorMode";

export const metadata: Metadata = {
  title: "MUI + Next.js Starter",
  description: "Material UI theming in Next.js (App Router)",
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <ColorModeProvider>{children}</ColorModeProvider>
      </body>
    </html>
  );
}
```

And pass the toggle into your `AppShell`:

```tsx
// src/components/AppShell.tsx (only the imports/toolbar changed)
"use client";
import * as React from "react";
import { AppBar, Toolbar, Typography, Container, Box, Stack, Button } from "@mui/material";
import Link from "next/link";
import ColorModeToggle from "./ColorModeToggle";

export default function AppShell({ children }: { children: React.ReactNode }) {
  return (
    <Box>
      <AppBar position="sticky" color="transparent" elevation={0}
        sx={{ backdropFilter: "blur(8px)", borderBottom: "1px solid", borderColor: "divider" }}>
        <Toolbar>
          <Typography variant="h6" sx={{ fontWeight: 800, letterSpacing: 0.2, flexGrow: 1 }}>
            CodingGita UI
          </Typography>
          <Stack direction="row" spacing={1} alignItems="center">
            <Button component={Link} href="http://codinggita.com/" variant="text">Home</Button>
            <Button component={Link} href="http://codinggita.com/" variant="text">Courses</Button>
            <ColorModeToggle />
          </Stack>
        </Toolbar>
      </AppBar>
      <Container sx={{ py: { xs: 3, md: 6 } }}>{children}</Container>
    </Box>
  );
}
```

You now have a **custom Material theme**, **responsive layouts**, **reusable UI components**, and a **persistent light/dark mode**—all wired for Next.js App Router with SSR-safe styles.

---

