## **1. What is an API in Next.js?**

In a Next.js project, you can write **backend code** directly inside your frontend project. This is possible because Next.js is a **full-stack framework** — it can handle both client-side (browser) and server-side (Node.js) code.

An API (Application Programming Interface) in this context means:

* A **backend endpoint** that receives HTTP requests (GET, POST, PUT, DELETE, etc.).
* Runs **server-side logic** (like reading from a database, updating data, performing calculations).
* Sends a **response** (usually JSON) back to the client.

Example:
If you go to `/api/students`, Next.js will run the server code you wrote and return some data.

---

## **2. Where are API routes placed in the App Router?**

In **Next.js 13+ App Router**, APIs live inside:

```
src/app/api/<route-name>/route.js
```

Example:

```
src/app/api/students/route.js
```

Here:

* `students` is the **API route name** → `/api/students`
* `route.js` contains **handler functions** for different HTTP methods (GET, POST, PUT, DELETE).

---

## **3. How API Routes Work in Next.js**

When you create an API route in the **App Router**, you export functions named after HTTP methods:

```javascript
export async function GET(request) { ... }
export async function POST(request) { ... }
export async function PUT(request) { ... }
export async function DELETE(request) { ... }
```

**How this works internally:**

* A client (browser, Postman, or fetch request) makes a request to `/api/students`.
* Next.js looks at `route.js` in that folder.
* It matches the request method (GET, POST, etc.) to the corresponding exported function.
* That function runs **on the server** (not in the browser).
* You send back a response using `NextResponse`.

---

## **4. How to Return Data**

To send data back, Next.js uses:

```javascript
import { NextResponse } from 'next/server';

export async function GET() {
  const data = [{ id: 1, name: "Jenil" }];
  return NextResponse.json(data);
}
```

Here:

* `NextResponse.json(data)` sends JSON-formatted data.
* The client receives this as a standard HTTP JSON response.

---

## **5. Handling Different HTTP Methods (CRUD)**

CRUD means:

* **Create** → `POST`
* **Read** → `GET`
* **Update** → `PUT` or `PATCH`
* **Delete** → `DELETE`

Example flow with `/api/students`:

1. **GET** → Fetch all students.
2. **POST** → Add a new student.
3. **PUT** → Update student data.
4. **DELETE** → Remove a student.

---

## **6. Dynamic API Routes in Next.js**

If you want `/api/students/123` to return data for a single student:

* Create a folder `[id]` inside `students`:

```
src/app/api/students/[id]/route.js
```

Inside:

```javascript
export async function GET(request, { params }) {
  const { id } = params; // Extracts "123"
  return NextResponse.json({ message: `Student with id ${id}` });
}
```

---

## **7. Where the Code Runs**

* **API routes always run on the server** in a Node.js environment.
* They do **not** run in the browser.
* This means you can use:

  * File system access
  * Secure environment variables
  * Database connections
    without exposing them to the public.

---

## **8. How the Client Calls These APIs**

From the browser or another frontend component:

```javascript
const res = await fetch('/api/students');
const data = await res.json();
```

Or with a dynamic route:

```javascript
const res = await fetch('/api/students/123');
```

---

## **9. Key Points to Remember**

* API routes are **backend functions** inside your Next.js app.
* Folder names determine the URL path.
* `route.js` contains handlers for HTTP methods.
* `NextResponse` is used to send responses.
* Dynamic routes use `[paramName]`.
* Runs on the **server** — safe for sensitive logic.

---

## **Flow of APIs in Next.js (App Router)**

### **1. Understanding the Basics**

* In Next.js **App Router** (introduced from version 13+), API routes are placed inside the `app/api` folder.
* Each API route is simply a **server function** that runs on the server side only — it does not ship to the client.
* You can define separate functions inside one file for different HTTP methods like `GET`, `POST`, `PUT`, `DELETE`.
* These functions **return a `Response` object** (not `res.send()` like in Express).

---

### **2. API Request → Server Handling → Response Flow**

1. **Client makes a request**

   * This could be from:

     * The browser (by visiting the URL directly).
     * A frontend component using `fetch()`.
     * An external service hitting your endpoint.
2. **Next.js checks your API folder**

   * The URL `/api/students` maps to the file `app/api/students/route.js` (or `.ts`).
   * Next.js calls the correct method handler based on the HTTP method used.
3. **Server-side code executes**

   * The function you define (`export async function GET()`, etc.) runs.
   * This function:

     * Can read query parameters or request body.
     * Perform data operations (read, add, update, delete).
     * Always runs securely on the server — no client can see this code.
4. **Server sends back a response**

   * You return data using `Response.json(data)` or `new Response("text")`.
   * The client receives this response and can display or process it.

---

### **3. Example: GET API (Fetching Data)**

* **URL:** `/api/students`
* **Purpose:** Returns the current list of students.
* **Flow:**

  1. Client calls `/api/students` (GET request).
  2. Next.js finds the `GET` function in `app/api/students/route.js`.
  3. That function reads from our students array.
  4. Response is sent as JSON.

---

### **4. Example: Dynamic GET API (Fetching Single Student)**

* **URL:** `/api/students/[id]`
* **Purpose:** Returns details of one student based on `id`.
* **Flow:**

  1. Client calls `/api/students/2`.
  2. Next.js looks for `app/api/students/[id]/route.js`.
  3. Inside `GET(request, { params })`:

     * `params.id` contains the `2` from the URL.
  4. Find the matching student from the array.
  5. Send it back as JSON.

---

### **5. POST API (Creating Data)**

* **URL:** `/api/students`
* **Purpose:** Add a new student to the array.
* **Flow:**

  1. Client sends a POST request with student details in the request body.
  2. Next.js runs the `POST` function.
  3. Reads `await request.json()` to get the sent data.
  4. Pushes it into the students array.
  5. Sends back confirmation with the updated array.

---

### **6. PUT API (Updating Data)**

* **URL:** `/api/students/[id]`
* **Purpose:** Updates details of a student by `id`.
* **Flow:**

  1. Client sends a PUT request to `/api/students/3` with updated details.
  2. Inside `PUT(request, { params })`:

     * Read `params.id` for target student.
     * Read `await request.json()` for updated data.
  3. Find that student and update their details.
  4. Return updated list or confirmation message.

---

### **7. DELETE API (Deleting Data)**

* **URL:** `/api/students/[id]`
* **Purpose:** Remove a student from the array.
* **Flow:**

  1. Client sends DELETE request to `/api/students/3`.
  2. Inside `DELETE(_, { params })`:

     * Use `params.id` to find the student.
     * Remove them from the array.
  3. Send confirmation as JSON.

---

### **8. Key Points to Remember**

* **Folder structure defines the route:**
  `/app/api/students/route.js` → `/api/students`
  `/app/api/students/[id]/route.js` → `/api/students/:id`

* **Each HTTP method has its own function:**

  ```js
  export async function GET() {}
  export async function POST() {}
  export async function PUT() {}
  export async function DELETE() {}
  ```

* **Always return a Response object:**

  ```js
  return Response.json(data);
  ```

* **Data storage in our example** is just an array in the same file (in real apps, you'd use a database).

---
